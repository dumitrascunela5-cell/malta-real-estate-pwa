<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malta Real Estate PRO</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#f97316">
    <link rel="icon" type="image/png" href="./icon-192.png">
    <meta name="description" content="Professional real estate management platform for Malta">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Leaflet for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- React & Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            /* Professional color scheme - Orange/Teal */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --accent-primary: #f97316;      /* Professional orange */
            --accent-secondary: #14b8a6;     /* Teal */
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
        }
        
        .light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            line-height: 1.2;
        }
        
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Tabs */
        .tabs {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 0.5rem;
            padding: 0 1.5rem;
        }
        
        .tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .tab:hover {
            color: var(--accent-primary);
        }
        
        .tab.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }
        
        /* Main Content */
        .main {
            flex: 1;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        
        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.2s;
        }
        
        .card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #ea580c;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
        }
        
        .btn-secondary {
            background: var(--accent-secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #0d9488;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .btn-outline:hover {
            background: var(--bg-tertiary);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9375rem;
            transition: all 0.2s;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }
        
        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-2 {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
        
        .grid-3 {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        }
        
        /* Map */
        #map {
            height: 600px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        
        /* Match Score Badge */
        .match-score {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .match-score.high {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        .match-score.medium {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        
        .match-score.low {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        /* Priority Badges */
        .priority {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .priority.high {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .priority.medium {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        
        .priority.low {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }
        
        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            opacity: 0.9;
            font-size: 0.875rem;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .modal-title {
            font-size: 1.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0.25rem;
        }
        
        /* Theme Toggle */
        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .theme-toggle:hover {
            background: var(--accent-primary);
            color: white;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .tabs-container {
                padding: 0 1rem;
            }
            
            .main {
                padding: 1rem;
            }
            
            #map {
                height: 400px;
            }
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://xevlfdjyvhhnyvxtwzsb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhldmxmZGp5dmhobnl2eHR3enNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMDQyODgsImV4cCI6MjA4NTg4MDI4OH0.vf9y_5h7jBKLEWP3AcGx3bvKZObukIXoHYLtdY42pwM';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Malta zones with coordinates and nearby areas
        const MALTA_ZONES = {
            'Sliema': { lat: 35.9120, lng: 14.5015, nearby: ['Gzira', 'St. Julians', 'Msida', "Ta' Xbiex"] },
            'St. Julians': { lat: 35.9188, lng: 14.4897, nearby: ['Sliema', 'Paceville', 'Swieqi'] },
            'Valletta': { lat: 35.8989, lng: 14.5146, nearby: ['Floriana', 'Hamrun', 'Msida'] },
            'Gzira': { lat: 35.9067, lng: 14.4975, nearby: ['Sliema', 'Msida', "Ta' Xbiex"] },
            'Msida': { lat: 35.8972, lng: 14.4872, nearby: ['Gzira', 'Birkirkara', 'Hamrun'] },
            'Birkirkara': { lat: 35.8972, lng: 14.4611, nearby: ['Hamrun', 'Msida', 'Balzan'] },
            'Mosta': { lat: 35.9092, lng: 14.4256, nearby: ['Naxxar', 'Birkirkara'] },
            'Qormi': { lat: 35.8764, lng: 14.4711, nearby: ['Hamrun', 'Marsa'] },
            'Zabbar': { lat: 35.8761, lng: 14.5400, nearby: ['Fgura', 'Marsaskala'] },
            'Mellieha': { lat: 35.9567, lng: 14.3625, nearby: ['St. Pauls Bay'] },
            'Swieqi': { lat: 35.9231, lng: 14.4803, nearby: ['St. Julians', 'Pembroke'] },
            'Naxxar': { lat: 35.9136, lng: 14.4436, nearby: ['Mosta', 'Gharghur'] },
            'Fgura': { lat: 35.8708, lng: 14.5139, nearby: ['Paola', 'Zabbar'] },
            'Hamrun': { lat: 35.8847, lng: 14.4881, nearby: ['Marsa', 'Qormi', 'Msida'] },
            'Marsaskala': { lat: 35.8619, lng: 14.5667, nearby: ['Zabbar', 'Birzebbuga'] },
            'Birzebbuga': { lat: 35.8253, lng: 14.5275, nearby: ['Marsaskala'] },
            'Attard': { lat: 35.8897, lng: 14.4417, nearby: ['Balzan', 'Lija'] },
            'Balzan': { lat: 35.9006, lng: 14.4533, nearby: ['Attard', 'Birkirkara'] },
            'Lija': { lat: 35.9008, lng: 14.4464, nearby: ['Balzan', 'Attard'] },
            'Marsa': { lat: 35.8808, lng: 14.4964, nearby: ['Hamrun', 'Paola'] },
            'Paola': { lat: 35.8728, lng: 14.5086, nearby: ['Tarxien', 'Fgura'] },
            'Tarxien': { lat: 35.8667, lng: 14.5100, nearby: ['Paola', 'Fgura'] },
            'Pembroke': { lat: 35.9339, lng: 14.4775, nearby: ['St. Julians', 'Swieqi'] },
            'Pieta': { lat: 35.8950, lng: 14.4950, nearby: ['Msida', 'Floriana'] },
            'San Gwann': { lat: 35.9083, lng: 14.4750, nearby: ['Swieqi', 'Birkirkara'] },
            "Ta' Xbiex": { lat: 35.8992, lng: 14.4958, nearby: ['Gzira', 'Msida', 'Sliema'] },
            'Zejtun': { lat: 35.8561, lng: 14.5333, nearby: ['Marsaskala', 'Zabbar'] },
            'Gharghur': { lat: 35.9239, lng: 14.4531, nearby: ['Naxxar'] },
            'St. Pauls Bay': { lat: 35.9500, lng: 14.4000, nearby: ['Bugibba', 'Qawra', 'Mellieha'] },
            'Bugibba': { lat: 35.9500, lng: 14.4117, nearby: ['St. Pauls Bay', 'Qawra'] },
            'Qawra': { lat: 35.9575, lng: 14.4183, nearby: ['Bugibba', 'St. Pauls Bay'] },
            'Marsaxlokk': { lat: 35.8417, lng: 14.5431, nearby: ['Birzebbuga', 'Zejtun'] },
            'Floriana': { lat: 35.8931, lng: 14.5056, nearby: ['Valletta', 'Hamrun'] },
            'Senglea': { lat: 35.8875, lng: 14.5169, nearby: ['Vittoriosa', 'Cospicua'] },
            'Vittoriosa': { lat: 35.8897, lng: 14.5217, nearby: ['Senglea', 'Cospicua'] },
            'Cospicua': { lat: 35.8856, lng: 14.5242, nearby: ['Vittoriosa', 'Senglea'] },
            'Siggiewi': { lat: 35.8553, lng: 14.4369, nearby: ['Rabat'] },
            'Rabat': { lat: 35.8817, lng: 14.3986, nearby: ['Mdina', 'Siggiewi'] },
            'Mdina': { lat: 35.8864, lng: 14.4028, nearby: ['Rabat'] },
            'Zebbug': { lat: 35.8717, lng: 14.4417, nearby: ['Siggiewi', 'Qormi'] },
            'Gudja': { lat: 35.8489, lng: 14.5028, nearby: ['Ghaxaq', 'Luqa'] },
            'Ghaxaq': { lat: 35.8489, lng: 14.5158, nearby: ['Gudja', 'Zejtun'] },
            'Luqa': { lat: 35.8600, lng: 14.4881, nearby: ['Gudja', 'Qormi'] },
            'Mqabba': { lat: 35.8467, lng: 14.4697, nearby: ['Qrendi'] },
            'Qrendi': { lat: 35.8353, lng: 14.4561, nearby: ['Mqabba', 'Zurrieq'] },
            'Zurrieq': { lat: 35.8311, lng: 14.4778, nearby: ['Qrendi'] },
            'Safi': { lat: 35.8356, lng: 14.4861, nearby: ['Zurrieq'] },
            'Kirkop': { lat: 35.8433, lng: 14.4856, nearby: ['Luqa', 'Safi'] },
            'Dingli': { lat: 35.8614, lng: 14.3825, nearby: ['Rabat'] },
            'Mtarfa': { lat: 35.8894, lng: 14.3956, nearby: ['Rabat', 'Mdina'] },
            'Kalkara': { lat: 35.8892, lng: 14.5317, nearby: ['Vittoriosa'] },
            'Xghajra': { lat: 35.8864, lng: 14.5472, nearby: ['Zabbar'] },
            'Santa Lucija': { lat: 35.8622, lng: 14.5050, nearby: ['Paola', 'Tarxien'] },
            'Fontana': { lat: 36.0372, lng: 14.2394, nearby: ['Victoria'] },
            'Ghajnsielem': { lat: 36.0269, lng: 14.2828, nearby: ['Mgarr'] },
            'Gharb': { lat: 36.0625, lng: 14.2094, nearby: ['Ghasri'] },
            'Ghasri': { lat: 36.0550, lng: 14.2269, nearby: ['Gharb', 'Zebbug'] },
            'Kercem': { lat: 36.0422, lng: 14.2306, nearby: ['Victoria'] },
            'Munxar': { lat: 36.0300, lng: 14.2375, nearby: ['Sannat'] },
            'Nadur': { lat: 36.0397, lng: 14.2944, nearby: ['Qala'] },
            'Qala': { lat: 36.0364, lng: 14.3086, nearby: ['Nadur'] },
            'San Lawrenz': { lat: 36.0558, lng: 14.2019, nearby: ['Gharb'] },
            'Sannat': { lat: 36.0239, lng: 14.2550, nearby: ['Munxar', 'Xewkija'] },
            'Victoria': { lat: 36.0444, lng: 14.2389, nearby: ['Fontana', 'Kercem', 'Gharb'] },
            'Xaghra': { lat: 36.0508, lng: 14.2650, nearby: ['Nadur', 'Zebbug'] },
            'Xewkija': { lat: 36.0314, lng: 14.2581, nearby: ['Sannat'] },
            'Zebbug': { lat: 36.0719, lng: 14.2450, nearby: ['Ghasri', 'Xaghra'] },
            'Mgarr': { lat: 36.0272, lng: 14.2958, nearby: ['Ghajnsielem'] }
        };
        
        // Smart matching algorithm
        const calculateMatchScore = (property, client) => {
            let score = 0;
            let reasons = [];
            
            // Price matching with tolerance (¬±15%)
            const priceTolerance = 0.15;
            const minPrice = client.budget * (1 - priceTolerance);
            const maxPrice = client.budget * (1 + priceTolerance);
            
            if (property.price >= minPrice && property.price <= maxPrice) {
                const priceDiff = Math.abs(property.price - client.budget) / client.budget;
                if (priceDiff <= 0.05) {
                    score += 40;
                    reasons.push('Perfect price match');
                } else if (priceDiff <= 0.10) {
                    score += 30;
                    reasons.push('Price negotiable');
                } else {
                    score += 20;
                    reasons.push('Within budget range');
                }
            }
            
            // Location matching with nearby areas
            if (property.location === client.preferred_location) {
                score += 30;
                reasons.push('Exact location match');
            } else {
                const clientZone = MALTA_ZONES[client.preferred_location];
                const propertyLocation = property.location;
                
                if (clientZone && clientZone.nearby.includes(propertyLocation)) {
                    // Don't match Gozo with mainland
                    const gozoLocations = ['Fontana', 'Ghajnsielem', 'Gharb', 'Ghasri', 'Kercem', 
                                          'Munxar', 'Nadur', 'Qala', 'San Lawrenz', 'Sannat', 
                                          'Victoria', 'Xaghra', 'Xewkija', 'Zebbug', 'Mgarr'];
                    
                    const isClientGozo = gozoLocations.includes(client.preferred_location);
                    const isPropertyGozo = gozoLocations.includes(propertyLocation);
                    
                    if (isClientGozo === isPropertyGozo) {
                        score += 20;
                        reasons.push('Nearby preferred area');
                    }
                }
            }
            
            // Property type match
            if (property.type === client.looking_for) {
                score += 20;
                reasons.push('Property type match');
            }
            
            // Bedrooms requirement
            if (property.bedrooms >= client.min_bedrooms) {
                score += 10;
                reasons.push('Bedrooms requirement met');
            }
            
            return {
                score,
                reasons,
                level: score >= 70 ? 'high' : score >= 50 ? 'medium' : 'low'
            };
        };
        
        // Main App Component
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [theme, setTheme] = useState('dark');
            const [properties, setProperties] = useState([]);
            const [clients, setClients] = useState([]);
            const [reminders, setReminders] = useState([]);
            const [communications, setCommunications] = useState([]);
            const [viewings, setViewings] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showModal, setShowModal] = useState(null);
            
            // Load data
            useEffect(() => {
                loadData();
            }, []);
            
            const loadData = async () => {
                setLoading(true);
                try {
                    const [propsRes, clientsRes, remindersRes, commsRes, viewingsRes] = await Promise.all([
                        supabase.from('properties').select('*').order('created_at', { ascending: false }),
                        supabase.from('clients').select('*').order('created_at', { ascending: false }),
                        supabase.from('reminders').select('*').order('due_date', { ascending: true }),
                        supabase.from('communications').select('*, clients(name), properties(title)').order('created_at', { ascending: false }),
                        supabase.from('viewings').select('*, properties(title), clients(name)').order('scheduled_date', { ascending: false })
                    ]);
                    
                    if (propsRes.data) setProperties(propsRes.data);
                    if (clientsRes.data) setClients(clientsRes.data);
                    if (remindersRes.data) setReminders(remindersRes.data);
                    if (commsRes.data) setCommunications(commsRes.data);
                    if (viewingsRes.data) setViewings(viewingsRes.data);
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            // Toggle theme
            useEffect(() => {
                if (theme === 'light') {
                    document.body.classList.add('light-mode');
                } else {
                    document.body.classList.remove('light-mode');
                }
            }, [theme]);
            
            // Calculate matches
            const matches = [];
            properties.filter(p => p.status === 'available').forEach(property => {
                clients.filter(c => c.status === 'active').forEach(client => {
                    const match = calculateMatchScore(property, client);
                    if (match.score >= 50) {
                        matches.push({
                            property,
                            client,
                            ...match
                        });
                    }
                });
            });
            
            matches.sort((a, b) => b.score - a.score);
            
            return (
                <>
                    <header className="header">
                        <div className="header-content">
                            <div className="logo">
                                üè† Malta RE PRO
                            </div>
                            <div className="header-actions">
                                <button 
                                    className="btn btn-primary"
                                    onClick={() => setShowModal('add-property')}
                                >
                                    + Add Property
                                </button>
                                <button 
                                    className="btn btn-secondary"
                                    onClick={() => setShowModal('add-client')}
                                >
                                    + Add Client
                                </button>
                                <button 
                                    className="theme-toggle"
                                    onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}
                                >
                                    {theme === 'dark' ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    <nav className="tabs">
                        <div className="tabs-container">
                            <button 
                                className={`tab ${activeTab === 'dashboard' ? 'active' : ''}`}
                                onClick={() => setActiveTab('dashboard')}
                            >
                                üìä Dashboard
                            </button>
                            <button 
                                className={`tab ${activeTab === 'matches' ? 'active' : ''}`}
                                onClick={() => setActiveTab('matches')}
                            >
                                üî• Smart Matches ({matches.length})
                            </button>
                            <button 
                                className={`tab ${activeTab === 'properties' ? 'active' : ''}`}
                                onClick={() => setActiveTab('properties')}
                            >
                                üè† Properties ({properties.length})
                            </button>
                            <button 
                                className={`tab ${activeTab === 'clients' ? 'active' : ''}`}
                                onClick={() => setActiveTab('clients')}
                            >
                                üë• Clients ({clients.length})
                            </button>
                            <button 
                                className={`tab ${activeTab === 'reminders' ? 'active' : ''}`}
                                onClick={() => setActiveTab('reminders')}
                            >
                                ‚è∞ Reminders ({reminders.filter(r => !r.completed).length})
                            </button>
                            <button 
                                className={`tab ${activeTab === 'map' ? 'active' : ''}`}
                                onClick={() => setActiveTab('map')}
                            >
                                üó∫Ô∏è Map
                            </button>
                        </div>
                    </nav>
                    
                    <main className="main">
                        {loading ? (
                            <div className="loading">
                                <div className="spinner"></div>
                                Loading data...
                            </div>
                        ) : (
                            <>
                                {activeTab === 'dashboard' && (
                                    <DashboardTab 
                                        properties={properties}
                                        clients={clients}
                                        matches={matches}
                                        reminders={reminders}
                                        viewings={viewings}
                                    />
                                )}
                                {activeTab === 'matches' && (
                                    <MatchesTab matches={matches} />
                                )}
                                {activeTab === 'properties' && (
                                    <PropertiesTab 
                                        properties={properties}
                                        onRefresh={loadData}
                                    />
                                )}
                                {activeTab === 'clients' && (
                                    <ClientsTab 
                                        clients={clients}
                                        onRefresh={loadData}
                                    />
                                )}
                                {activeTab === 'reminders' && (
                                    <RemindersTab 
                                        reminders={reminders}
                                        onRefresh={loadData}
                                    />
                                )}
                                {activeTab === 'map' && (
                                    <MapTab properties={properties} />
                                )}
                            </>
                        )}
                    </main>
                    
                    {showModal === 'add-property' && (
                        <PropertyModal 
                            onClose={() => setShowModal(null)}
                            onSuccess={() => {
                                setShowModal(null);
                                loadData();
                            }}
                        />
                    )}
                    
                    {showModal === 'add-client' && (
                        <ClientModal 
                            onClose={() => setShowModal(null)}
                            onSuccess={() => {
                                setShowModal(null);
                                loadData();
                            }}
                        />
                    )}
                </>
            );
        }
        
        // Dashboard Tab
        function DashboardTab({ properties, clients, matches, reminders, viewings }) {
            const activeProperties = properties.filter(p => p.status === 'available').length;
            const activeClients = clients.filter(c => c.status === 'active').length;
            const pendingReminders = reminders.filter(r => !r.completed).length;
            const upcomingViewings = viewings.filter(v => v.status === 'scheduled').length;
            
            return (
                <div>
                    <h2 style={{ marginBottom: '2rem' }}>Dashboard Overview</h2>
                    
                    <div className="grid grid-3">
                        <div className="stat-card">
                            <div className="stat-value">{activeProperties}</div>
                            <div className="stat-label">Active Properties</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{activeClients}</div>
                            <div className="stat-label">Active Clients</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{matches.length}</div>
                            <div className="stat-label">Smart Matches</div>
                        </div>
                    </div>
                    
                    <h3 style={{ marginTop: '2rem', marginBottom: '1rem' }}>Top Matches Today</h3>
                    {matches.slice(0, 3).length > 0 ? (
                        <div className="grid grid-2">
                            {matches.slice(0, 3).map((match, idx) => (
                                <div key={idx} className="card">
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>
                                        <div>
                                            <h4>{match.property.title}</h4>
                                            <p style={{ color: 'var(--text-secondary)', fontSize: '0.875rem' }}>
                                                {match.client.name}
                                            </p>
                                        </div>
                                        <span className={`match-score ${match.level}`}>
                                            {match.score}% Match
                                        </span>
                                    </div>
                                    <p style={{ fontSize: '0.875rem', color: 'var(--text-muted)', marginBottom: '1rem' }}>
                                        {match.reasons.join(' ‚Ä¢ ')}
                                    </p>
                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                        <button className="btn btn-primary" style={{ fontSize: '0.75rem' }}>
                                            üìû Call
                                        </button>
                                        <button className="btn btn-secondary" style={{ fontSize: '0.75rem' }}>
                                            üìß Email
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-state-icon">üîç</div>
                            <p>No matches yet. Add properties and clients to get started!</p>
                        </div>
                    )}
                    
                    <h3 style={{ marginTop: '2rem', marginBottom: '1rem' }}>Upcoming Reminders</h3>
                    {reminders.filter(r => !r.completed).slice(0, 5).length > 0 ? (
                        <div className="card">
                            {reminders.filter(r => !r.completed).slice(0, 5).map(reminder => (
                                <div key={reminder.id} style={{ 
                                    padding: '1rem', 
                                    borderBottom: '1px solid var(--border)',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <div>
                                        <h4 style={{ fontSize: '0.9375rem' }}>{reminder.title}</h4>
                                        <p style={{ fontSize: '0.8125rem', color: 'var(--text-muted)' }}>
                                            Due: {new Date(reminder.due_date).toLocaleDateString()}
                                        </p>
                                    </div>
                                    <span className={`priority ${reminder.priority}`}>
                                        {reminder.priority}
                                    </span>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-state-icon">‚úÖ</div>
                            <p>All caught up! No pending reminders.</p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Smart Matches Tab
        function MatchesTab({ matches }) {
            return (
                <div>
                    <h2 style={{ marginBottom: '2rem' }}>Smart Matches ({matches.length})</h2>
                    
                    {matches.length > 0 ? (
                        <div className="grid grid-2">
                            {matches.map((match, idx) => (
                                <div key={idx} className="card">
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>
                                        <div style={{ flex: 1 }}>
                                            <h3 style={{ fontSize: '1.125rem', marginBottom: '0.5rem' }}>
                                                {match.property.title}
                                            </h3>
                                            <p style={{ color: 'var(--text-secondary)', fontSize: '0.9375rem' }}>
                                                üí∞ ‚Ç¨{match.property.price.toLocaleString()} ‚Ä¢ 
                                                üìç {match.property.location} ‚Ä¢ 
                                                üõèÔ∏è {match.property.bedrooms} beds
                                            </p>
                                        </div>
                                        <span className={`match-score ${match.level}`}>
                                            {match.score}%
                                        </span>
                                    </div>
                                    
                                    <div style={{ 
                                        background: 'var(--bg-tertiary)', 
                                        padding: '1rem', 
                                        borderRadius: '8px',
                                        marginBottom: '1rem'
                                    }}>
                                        <h4 style={{ fontSize: '0.875rem', marginBottom: '0.5rem' }}>
                                            üë§ {match.client.name}
                                        </h4>
                                        <p style={{ fontSize: '0.8125rem', color: 'var(--text-secondary)' }}>
                                            Budget: ‚Ç¨{match.client.budget.toLocaleString()} ‚Ä¢ 
                                            Looking for: {match.client.looking_for} in {match.client.preferred_location}
                                        </p>
                                    </div>
                                    
                                    <div style={{ 
                                        background: 'rgba(249, 115, 22, 0.1)', 
                                        padding: '0.75rem', 
                                        borderRadius: '8px',
                                        marginBottom: '1rem',
                                        fontSize: '0.8125rem',
                                        color: 'var(--accent-primary)'
                                    }}>
                                        ‚ú® {match.reasons.join(' ‚Ä¢ ')}
                                    </div>
                                    
                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                        <button 
                                            className="btn btn-primary" 
                                            style={{ flex: 1 }}
                                            onClick={() => window.location.href = `tel:${match.client.phone}`}
                                        >
                                            üìû Call
                                        </button>
                                        <button 
                                            className="btn btn-secondary" 
                                            style={{ flex: 1 }}
                                            onClick={() => window.location.href = `mailto:${match.client.email}`}
                                        >
                                            üìß Email
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-state-icon">üîç</div>
                            <h3>No Matches Found</h3>
                            <p>Add more properties and clients to discover matches!</p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Properties Tab
        function PropertiesTab({ properties, onRefresh }) {
            return (
                <div>
                    <h2 style={{ marginBottom: '2rem' }}>All Properties ({properties.length})</h2>
                    
                    {properties.length > 0 ? (
                        <div className="grid grid-2">
                            {properties.map(property => (
                                <div key={property.id} className="card">
                                    <h3 style={{ fontSize: '1.125rem', marginBottom: '0.5rem' }}>
                                        {property.title}
                                    </h3>
                                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.9375rem', marginBottom: '1rem' }}>
                                        {property.type} ‚Ä¢ {property.location}
                                    </p>
                                    <div style={{ 
                                        display: 'grid', 
                                        gridTemplateColumns: '1fr 1fr', 
                                        gap: '0.75rem',
                                        marginBottom: '1rem'
                                    }}>
                                        <div>
                                            <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>Price</p>
                                            <p style={{ fontWeight: 600, color: 'var(--accent-primary)' }}>
                                                ‚Ç¨{property.price.toLocaleString()}
                                            </p>
                                        </div>
                                        <div>
                                            <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>Bedrooms</p>
                                            <p style={{ fontWeight: 600 }}>{property.bedrooms}</p>
                                        </div>
                                        <div>
                                            <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>Status</p>
                                            <p style={{ 
                                                fontWeight: 600,
                                                color: property.status === 'available' ? 'var(--success)' : 'var(--text-muted)'
                                            }}>
                                                {property.status}
                                            </p>
                                        </div>
                                        {property.size_sqm && (
                                            <div>
                                                <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)' }}>Size</p>
                                                <p style={{ fontWeight: 600 }}>{property.size_sqm}m¬≤</p>
                                            </div>
                                        )}
                                    </div>
                                    {property.description && (
                                        <p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)', marginBottom: '1rem' }}>
                                            {property.description}
                                        </p>
                                    )}
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-state-icon">üè†</div>
                            <h3>No Properties Yet</h3>
                            <p>Start by adding your first property!</p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Clients Tab
        function ClientsTab({ clients, onRefresh }) {
            return (
                <div>
                    <h2 style={{ marginBottom: '2rem' }}>All Clients ({clients.length})</h2>
                    
                    {clients.length > 0 ? (
                        <div className="grid grid-2">
                            {clients.map(client => (
                                <div key={client.id} className="card">
                                    <h3 style={{ fontSize: '1.125rem', marginBottom: '0.5rem' }}>
                                        {client.name}
                                    </h3>
                                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.875rem', marginBottom: '1rem' }}>
                                        üìß {client.email} ‚Ä¢ üìû {client.phone}
                                    </p>
                                    <div style={{ 
                                        background: 'var(--bg-tertiary)', 
                                        padding: '1rem', 
                                        borderRadius: '8px',
                                        marginBottom: '1rem'
                                    }}>
                                        <p style={{ fontSize: '0.8125rem', marginBottom: '0.5rem' }}>
                                            <strong>Looking for:</strong> {client.looking_for}
                                        </p>
                                        <p style={{ fontSize: '0.8125rem', marginBottom: '0.5rem' }}>
                                            <strong>Location:</strong> {client.preferred_location}
                                        </p>
                                        <p style={{ fontSize: '0.8125rem', marginBottom: '0.5rem' }}>
                                            <strong>Budget:</strong> ‚Ç¨{client.budget.toLocaleString()}
                                        </p>
                                        <p style={{ fontSize: '0.8125rem' }}>
                                            <strong>Min Bedrooms:</strong> {client.min_bedrooms}
                                        </p>
                                    </div>
                                    {client.notes && (
                                        <p style={{ fontSize: '0.875rem', color: 'var(--text-muted)', marginBottom: '1rem' }}>
                                            üí¨ {client.notes}
                                        </p>
                                    )}
                                    <div style={{ display: 'flex', gap: '0.5rem' }}>
                                        <button 
                                            className="btn btn-primary" 
                                            style={{ flex: 1, fontSize: '0.8125rem' }}
                                            onClick={() => window.location.href = `tel:${client.phone}`}
                                        >
                                            üìû Call
                                        </button>
                                        <button 
                                            className="btn btn-secondary" 
                                            style={{ flex: 1, fontSize: '0.8125rem' }}
                                            onClick={() => window.location.href = `mailto:${client.email}`}
                                        >
                                            üìß Email
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-state-icon">üë•</div>
                            <h3>No Clients Yet</h3>
                            <p>Start by adding your first client!</p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Reminders Tab
        function RemindersTab({ reminders, onRefresh }) {
            const toggleComplete = async (id, completed) => {
                await supabase
                    .from('reminders')
                    .update({ completed: !completed })
                    .eq('id', id);
                onRefresh();
            };
            
            const pending = reminders.filter(r => !r.completed);
            const completed = reminders.filter(r => r.completed);
            
            return (
                <div>
                    <h2 style={{ marginBottom: '2rem' }}>Reminders & Tasks</h2>
                    
                    <h3 style={{ marginBottom: '1rem' }}>Pending ({pending.length})</h3>
                    {pending.length > 0 ? (
                        <div className="grid grid-2">
                            {pending.map(reminder => (
                                <div key={reminder.id} className="card">
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '0.75rem' }}>
                                        <h4>{reminder.title}</h4>
                                        <span className={`priority ${reminder.priority}`}>
                                            {reminder.priority}
                                        </span>
                                    </div>
                                    {reminder.description && (
                                        <p style={{ fontSize: '0.875rem', color: 'var(--text-secondary)', marginBottom: '0.75rem' }}>
                                            {reminder.description}
                                        </p>
                                    )}
                                    <p style={{ fontSize: '0.8125rem', color: 'var(--text-muted)', marginBottom: '1rem' }}>
                                        üìÖ Due: {new Date(reminder.due_date).toLocaleDateString()}
                                    </p>
                                    <button 
                                        className="btn btn-outline"
                                        style={{ width: '100%' }}
                                        onClick={() => toggleComplete(reminder.id, reminder.completed)}
                                    >
                                        ‚úì Mark Complete
                                    </button>
                                </div>
                            ))}
                        </div>
                    ) : (
                        <div className="empty-state">
                            <div className="empty-state-icon">‚úÖ</div>
                            <p>All caught up! No pending reminders.</p>
                        </div>
                    )}
                    
                    {completed.length > 0 && (
                        <>
                            <h3 style={{ marginTop: '2rem', marginBottom: '1rem' }}>Completed ({completed.length})</h3>
                            <div className="grid grid-2">
                                {completed.map(reminder => (
                                    <div key={reminder.id} className="card" style={{ opacity: 0.6 }}>
                                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>
                                            <div style={{ flex: 1 }}>
                                                <h4 style={{ textDecoration: 'line-through' }}>{reminder.title}</h4>
                                                <p style={{ fontSize: '0.8125rem', color: 'var(--text-muted)' }}>
                                                    Completed
                                                </p>
                                            </div>
                                            <button 
                                                className="btn btn-outline"
                                                style={{ fontSize: '0.75rem' }}
                                                onClick={() => toggleComplete(reminder.id, reminder.completed)}
                                            >
                                                Undo
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </>
                    )}
                </div>
            );
        }
        
        // Map Tab
        function MapTab({ properties }) {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            
            useEffect(() => {
                if (!mapRef.current || mapInstanceRef.current) return;
                
                // Initialize map centered on Malta
                const map = L.map(mapRef.current).setView([35.9375, 14.3754], 11);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);
                
                mapInstanceRef.current = map;
                
                // Add markers for properties
                properties.forEach(property => {
                    const zone = MALTA_ZONES[property.location];
                    if (zone) {
                        const marker = L.marker([zone.lat, zone.lng]).addTo(map);
                        marker.bindPopup(`
                            <div style="font-family: Inter, sans-serif;">
                                <h3 style="margin: 0 0 8px 0; font-size: 1rem;">${property.title}</h3>
                                <p style="margin: 4px 0; font-size: 0.875rem;"><strong>‚Ç¨${property.price.toLocaleString()}</strong></p>
                                <p style="margin: 4px 0; font-size: 0.875rem;">${property.type} ‚Ä¢ ${property.bedrooms} beds</p>
                                <p style="margin: 4px 0; font-size: 0.875rem; color: #666;">${property.location}</p>
                            </div>
                        `);
                    }
                });
                
                return () => {
                    if (mapInstanceRef.current) {
                        mapInstanceRef.current.remove();
                        mapInstanceRef.current = null;
                    }
                };
            }, [properties]);
            
            return (
                <div>
                    <h2 style={{ marginBottom: '2rem' }}>Property Map</h2>
                    <div ref={mapRef} id="map"></div>
                </div>
            );
        }
        
        // Property Modal
        function PropertyModal({ onClose, onSuccess }) {
            const [formData, setFormData] = useState({
                title: '',
                type: 'Apartment',
                location: 'Sliema',
                price: '',
                bedrooms: '',
                bathrooms: '',
                size_sqm: '',
                description: '',
                status: 'available'
            });
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                const { error } = await supabase
                    .from('properties')
                    .insert([formData]);
                
                if (error) {
                    console.error('Error adding property:', error);
                    alert('Error adding property');
                } else {
                    onSuccess();
                }
            };
            
            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">Add Property</h2>
                            <button className="close-btn" onClick={onClose}>‚úï</button>
                        </div>
                        
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Title *</label>
                                <input 
                                    type="text" 
                                    className="form-input"
                                    value={formData.title}
                                    onChange={e => setFormData({...formData, title: e.target.value})}
                                    required
                                />
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                <div className="form-group">
                                    <label className="form-label">Type *</label>
                                    <select 
                                        className="form-select"
                                        value={formData.type}
                                        onChange={e => setFormData({...formData, type: e.target.value})}
                                        required
                                    >
                                        <option>Apartment</option>
                                        <option>House</option>
                                        <option>Villa</option>
                                        <option>Commercial</option>
                                    </select>
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Location *</label>
                                    <select 
                                        className="form-select"
                                        value={formData.location}
                                        onChange={e => setFormData({...formData, location: e.target.value})}
                                        required
                                    >
                                        {Object.keys(MALTA_ZONES).map(zone => (
                                            <option key={zone}>{zone}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                <div className="form-group">
                                    <label className="form-label">Price (‚Ç¨) *</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.price}
                                        onChange={e => setFormData({...formData, price: e.target.value})}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Bedrooms *</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.bedrooms}
                                        onChange={e => setFormData({...formData, bedrooms: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                <div className="form-group">
                                    <label className="form-label">Bathrooms</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.bathrooms}
                                        onChange={e => setFormData({...formData, bathrooms: e.target.value})}
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Size (m¬≤)</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.size_sqm}
                                        onChange={e => setFormData({...formData, size_sqm: e.target.value})}
                                    />
                                </div>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Description</label>
                                <textarea 
                                    className="form-textarea"
                                    rows="3"
                                    value={formData.description}
                                    onChange={e => setFormData({...formData, description: e.target.value})}
                                ></textarea>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Status *</label>
                                <select 
                                    className="form-select"
                                    value={formData.status}
                                    onChange={e => setFormData({...formData, status: e.target.value})}
                                    required
                                >
                                    <option value="available">Available</option>
                                    <option value="sold">Sold</option>
                                    <option value="rented">Rented</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                            
                            <div style={{ display: 'flex', gap: '1rem', marginTop: '1.5rem' }}>
                                <button type="button" className="btn btn-outline" style={{ flex: 1 }} onClick={onClose}>
                                    Cancel
                                </button>
                                <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>
                                    Add Property
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }
        
        // Client Modal
        function ClientModal({ onClose, onSuccess }) {
            const [formData, setFormData] = useState({
                name: '',
                email: '',
                phone: '',
                looking_for: 'Apartment',
                preferred_location: 'Sliema',
                budget: '',
                min_bedrooms: '',
                max_bedrooms: '',
                notes: '',
                status: 'active'
            });
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                const { error } = await supabase
                    .from('clients')
                    .insert([formData]);
                
                if (error) {
                    console.error('Error adding client:', error);
                    alert('Error adding client');
                } else {
                    onSuccess();
                }
            };
            
            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">Add Client</h2>
                            <button className="close-btn" onClick={onClose}>‚úï</button>
                        </div>
                        
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Name *</label>
                                <input 
                                    type="text" 
                                    className="form-input"
                                    value={formData.name}
                                    onChange={e => setFormData({...formData, name: e.target.value})}
                                    required
                                />
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                <div className="form-group">
                                    <label className="form-label">Email *</label>
                                    <input 
                                        type="email" 
                                        className="form-input"
                                        value={formData.email}
                                        onChange={e => setFormData({...formData, email: e.target.value})}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Phone *</label>
                                    <input 
                                        type="tel" 
                                        className="form-input"
                                        value={formData.phone}
                                        onChange={e => setFormData({...formData, phone: e.target.value})}
                                        required
                                    />
                                </div>
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                <div className="form-group">
                                    <label className="form-label">Looking For *</label>
                                    <select 
                                        className="form-select"
                                        value={formData.looking_for}
                                        onChange={e => setFormData({...formData, looking_for: e.target.value})}
                                        required
                                    >
                                        <option>Apartment</option>
                                        <option>House</option>
                                        <option>Villa</option>
                                        <option>Commercial</option>
                                    </select>
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Preferred Location *</label>
                                    <select 
                                        className="form-select"
                                        value={formData.preferred_location}
                                        onChange={e => setFormData({...formData, preferred_location: e.target.value})}
                                        required
                                    >
                                        {Object.keys(MALTA_ZONES).map(zone => (
                                            <option key={zone}>{zone}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Budget (‚Ç¨) *</label>
                                <input 
                                    type="number" 
                                    className="form-input"
                                    value={formData.budget}
                                    onChange={e => setFormData({...formData, budget: e.target.value})}
                                    required
                                />
                            </div>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem' }}>
                                <div className="form-group">
                                    <label className="form-label">Min Bedrooms *</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.min_bedrooms}
                                        onChange={e => setFormData({...formData, min_bedrooms: e.target.value})}
                                        required
                                    />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Max Bedrooms</label>
                                    <input 
                                        type="number" 
                                        className="form-input"
                                        value={formData.max_bedrooms}
                                        onChange={e => setFormData({...formData, max_bedrooms: e.target.value})}
                                    />
                                </div>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">Notes</label>
                                <textarea 
                                    className="form-textarea"
                                    rows="3"
                                    value={formData.notes}
                                    onChange={e => setFormData({...formData, notes: e.target.value})}
                                ></textarea>
                            </div>
                            
                            <div style={{ display: 'flex', gap: '1rem', marginTop: '1.5rem' }}>
                                <button type="button" className="btn btn-outline" style={{ flex: 1 }} onClick={onClose}>
                                    Cancel
                                </button>
                                <button type="submit" className="btn btn-secondary" style={{ flex: 1 }}>
                                    Add Client
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }
        
        // Render app
        ReactDOM.render(<App />, document.getElementById('root'));
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('‚úÖ Service Worker registered'))
                    .catch(err => console.log('‚ùå Service Worker error:', err));
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malta Real Estate PRO</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#f97316">
    <link rel="icon" type="image/png" href="./icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body, #root { width: 100%; height: 100%; overflow: hidden; }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0f172a;
            color: #e2e8f0;
        }
        
        .sidebar {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-right: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        /* FLAT CARD DESIGN - CLEAN & SIMPLE */
        .card {
            background: #1e293b;
            border: 1px solid #334155;
            transition: all 0.2s ease;
        }
        
        .card:hover {
            border-color: #f97316;
            box-shadow: 0 0 0 1px #f97316;
        }
        
        /* GLASS EFFECT FOR FORMS */
        .glass { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(148, 163, 184, 0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        }
        
        .tab-active { 
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(249, 115, 22, 0.6); 
        }
        
        .btn-edit {
            background: #3b82f6;
            color: white;
            transition: all 0.2s ease;
        }
        
        .btn-edit:hover {
            background: #2563eb;
        }
        
        .input-field {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
            color: #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }
        
        .match-score {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        
        .autocomplete-dropdown {
            position: absolute;
            z-index: 1000;
            background: #1e293b;
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.5rem;
            margin-top: 0.25rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .autocomplete-item {
            padding: 0.75rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        
        .autocomplete-item:hover {
            background: rgba(249, 115, 22, 0.1);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-gabriel { background: #3b82f6; color: white; }
        .badge-georgiana { background: #ec4899; color: white; }
        
        /* INFO ROW - KEY INFO AT TOP */
        .info-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-label {
            font-size: 0.7rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .info-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f97316;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ===== CONFIGURATION =====
        const SUPABASE_URL = 'https://xevlfdjyvhhnyvxtwzsb.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhldmxmZGp5dmhobnl2eHR3enNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzMDQyODgsImV4cCI6MjA4NTg4MDI4OH0.vf9y_5h7jBKLEWP3AcGx3bvKZObukIXoHYLtdY42pwM';
        
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const PROPERTY_TYPES = ['Apartment', 'Penthouse', 'House', 'Duplex', 'Studio', 'Maisonette', 'Villa', 'Townhouse', 'Farmhouse', 'Office', 'Shop', 'Warehouse'];
        
        const MALTA_LOCATIONS = [
            'Attard', 'Balzan', 'Birgu', 'Birkirkara', 'Bir≈ºebbuƒ°a', 'Bormla', 'Dingli', 'Fgura',
            'Floriana', 'Fontana', 'Gƒßajnsielem', 'Gƒßarb', 'Gƒßargƒßur', 'Gƒßasri', 'Gƒßaxaq', 'Gudja',
            'G≈ºira', 'ƒ¶amrun', 'Iklin', 'Isla', 'Kalkara', 'Kerƒãem', 'Kirkop', 'Lija', 'Luqa',
            'Marsa', 'Marsaskala', 'Marsaxlokk', 'Mdina', 'Mellieƒßa', 'Mƒ°arr', 'Mosta', 'Mqabba',
            'Msida', 'Mtarfa', 'Munxar', 'Nadur', 'Naxxar', 'Paola', 'Pembroke', 'Piet√†', 'Qala',
            'Qormi', 'Qrendi', 'Rabat', 'Safi', 'San ƒ†iljan', 'San ƒ†wann', 'San Lawrenz', 'San Pawl il-Baƒßar',
            'Sannat', 'Santa Luƒãija', 'Santa Venera', 'Senglea', 'Siƒ°ƒ°iewi', 'Sliema', 'Swieqi',
            'Ta\' Xbiex', 'Tarxien', 'Valletta', 'Xagƒßra', 'Xewkija', 'Xgƒßajra', '≈ªabbar', '≈ªebbuƒ°',
            '≈ªejtun', '≈ªurrieq', 'St. Julians', 'St. Pauls Bay', 'St. Venera'
        ];

        const NEARBY_LOCATIONS = {
            'Sliema': ['G≈ºira', 'Ta\' Xbiex', 'Msida', 'San ƒ†iljan'],
            'G≈ºira': ['Sliema', 'Ta\' Xbiex', 'Msida'],
            'San ƒ†iljan': ['Sliema', 'San ƒ†wann', 'Swieqi', 'Pembroke'],
            'Mellieƒßa': ['San Pawl il-Baƒßar', 'Mƒ°arr'],
            'Valletta': ['Floriana', 'Piet√†', 'ƒ¶amrun'],
            'Msida': ['G≈ºira', 'Sliema', 'Ta\' Xbiex', 'Birkirkara'],
            'Birkirkara': ['ƒ¶amrun', 'Msida', 'San ƒ†wann', 'Balzan'],
            'Naxxar': ['Mosta', 'San Pawl il-Baƒßar', 'Gƒßargƒßur'],
            'Mosta': ['Naxxar', 'Attard', 'Lija', 'Balzan']
        };

        // ===== MATCHING ALGORITHM =====
        function calculateDetailedMatch(property, client) {
            let priceScore = 0, locationScore = 0, typeScore = 0, bedroomScore = 0, totalScore = 0;
            
            const propPrice = parseFloat(property.price_per_month);
            const clientBudget = parseFloat(client.budget);
            const priceDiff = Math.abs(propPrice - clientBudget);

            // PRICE MATCHING (40%)
            if (priceDiff <= 100) {
                priceScore = 100;
            } else if (property.negotiable && priceDiff <= 200) {
                priceScore = 100;
            } else {
                const percentDiff = (priceDiff / clientBudget) * 100;
                priceScore = Math.max(0, 100 - percentDiff);
            }

            // LOCATION MATCHING (30%)
            const propLoc = property.location.toLowerCase();
            let locationMatch = false;
            
            client.locations.forEach(clientLoc => {
                const cLoc = clientLoc.toLowerCase();
                if (propLoc === cLoc) {
                    locationScore = 100;
                    locationMatch = true;
                } else if (!locationMatch) {
                    const nearby = NEARBY_LOCATIONS[property.location] || [];
                    if (nearby.some(n => n.toLowerCase() === cLoc)) {
                        locationScore = Math.max(locationScore, 60);
                        locationMatch = true;
                    }
                }
            });

            // TYPE MATCHING (20%)
            if (client.looking_for.includes(property.type)) {
                typeScore = 100;
            }

            // BEDROOM MATCHING (10%)
            if (property.bedrooms >= client.min_bedrooms && 
                property.bedrooms <= (client.max_bedrooms || client.min_bedrooms + 2)) {
                bedroomScore = 100;
            } else {
                const diff = Math.abs(property.bedrooms - client.min_bedrooms);
                bedroomScore = Math.max(0, 100 - (diff * 25));
            }

            totalScore = (priceScore * 0.4) + (locationScore * 0.3) + (typeScore * 0.2) + (bedroomScore * 0.1);

            return {
                total: Math.round(totalScore),
                price: Math.round(priceScore),
                location: Math.round(locationScore),
                type: Math.round(typeScore),
                bedroom: Math.round(bedroomScore),
                priceDiff: priceDiff
            };
        }

        // ===== AUTOCOMPLETE COMPONENT =====
        function LocationAutocomplete({ value, onChange, multiple = false, placeholder = "Start typing..." }) {
            const [input, setInput] = useState('');
            const [showDropdown, setShowDropdown] = useState(false);
            const [selected, setSelected] = useState(multiple ? (value || []) : []);

            const filteredLocations = input.length > 0 
                ? MALTA_LOCATIONS.filter(loc => loc.toLowerCase().startsWith(input.toLowerCase()))
                : [];

            const handleSelect = (location) => {
                if (multiple) {
                    const newSelected = [...selected, location];
                    setSelected(newSelected);
                    onChange(newSelected);
                } else {
                    onChange(location);
                }
                setInput('');
                setShowDropdown(false);
            };

            const handleRemove = (location) => {
                const newSelected = selected.filter(l => l !== location);
                setSelected(newSelected);
                onChange(newSelected);
            };

            return (
                <div>
                    {multiple && selected.length > 0 && (
                        <div className="flex flex-wrap gap-2 mb-2">
                            {selected.map(loc => (
                                <span key={loc} className="bg-orange-500 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2">
                                    {loc}
                                    <button onClick={() => handleRemove(loc)} className="hover:text-red-200">√ó</button>
                                </span>
                            ))}
                        </div>
                    )}
                    <div className="relative">
                        <input
                            type="text"
                            value={multiple ? input : (value || input)}
                            onChange={(e) => {
                                setInput(e.target.value);
                                if (!multiple) onChange(e.target.value);
                                setShowDropdown(true);
                            }}
                            onFocus={() => setShowDropdown(true)}
                            className="input-field w-full px-4 py-3 rounded-lg"
                            placeholder={placeholder}
                        />
                        {showDropdown && filteredLocations.length > 0 && (
                            <div className="autocomplete-dropdown w-full">
                                {filteredLocations.map(loc => (
                                    <div
                                        key={loc}
                                        onClick={() => handleSelect(loc)}
                                        className="autocomplete-item"
                                    >
                                        {loc}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // ===== MAIN APP =====
        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [properties, setProperties] = useState([]);
            const [clients, setClients] = useState([]);
            const [loading, setLoading] = useState(true);
            const [currentUser, setCurrentUser] = useState('Gabriel QL');
            const [editingProperty, setEditingProperty] = useState(null);
            const [editingClient, setEditingClient] = useState(null);

            // Property Form
            const [propForm, setPropForm] = useState({
                reference_number: '',
                type: 'Apartment',
                bedrooms: 1,
                available_from: '',
                price_per_month: '',
                negotiable: false,
                location: '',
                notes: ''
            });

            // Client Form
            const [clientForm, setClientForm] = useState({
                name: '',
                phone: '',
                looking_for: [],
                locations: [],
                moving_date: '',
                nationality: '',
                occupation: '',
                how_many_people: 1,
                pets: false,
                let_type: 'Long Let',
                budget: '',
                min_bedrooms: 1,
                max_bedrooms: 3,
                other_requirements: '',
                notes: ''
            });

            // ===== FETCH DATA =====
            useEffect(() => {
                fetchAllData();
            }, []);

            async function fetchAllData() {
                setLoading(true);
                try {
                    const [propsData, clientsData] = await Promise.all([
                        supabaseClient.from('properties').select('*').order('created_at', { ascending: false }),
                        supabaseClient.from('clients').select('*').order('created_at', { ascending: false })
                    ]);

                    if (propsData.error) throw propsData.error;
                    if (clientsData.error) throw clientsData.error;

                    setProperties(propsData.data || []);
                    setClients(clientsData.data || []);
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error loading data: ' + error.message);
                }
                setLoading(false);
                setTimeout(() => lucide.createIcons(), 100);
            }

            // ===== CALCULATE MATCHES =====
            const matches = useMemo(() => {
                const allMatches = [];
                
                properties.forEach(property => {
                    clients.forEach(client => {
                        const matchScores = calculateDetailedMatch(property, client);
                        if (matchScores.total >= 40) {
                            allMatches.push({
                                property,
                                client,
                                scores: matchScores
                            });
                        }
                    });
                });

                return allMatches.sort((a, b) => b.scores.total - a.scores.total);
            }, [properties, clients]);

            // ===== ADD/UPDATE PROPERTY =====
            async function handlePropertySubmit(e) {
                e.preventDefault();
                setLoading(true);

                try {
                    const data = {
                        ...propForm,
                        added_by: currentUser
                    };

                    if (editingProperty) {
                        // UPDATE
                        const { error } = await supabaseClient
                            .from('properties')
                            .update(data)
                            .eq('id', editingProperty.id);
                        
                        if (error) throw error;
                        alert('Property updated!');
                        setEditingProperty(null);
                    } else {
                        // ADD NEW
                        const { error } = await supabaseClient
                            .from('properties')
                            .insert([data]);
                        
                        if (error) throw error;
                        alert('Property added!');
                    }

                    // Reset form
                    setPropForm({
                        reference_number: '',
                        type: 'Apartment',
                        bedrooms: 1,
                        available_from: '',
                        price_per_month: '',
                        negotiable: false,
                        location: '',
                        notes: ''
                    });
                    
                    fetchAllData();
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error: ' + error.message);
                }
                setLoading(false);
            }

            // ===== ADD/UPDATE CLIENT =====
            async function handleClientSubmit(e) {
                e.preventDefault();
                setLoading(true);

                try {
                    const data = {
                        ...clientForm,
                        added_by: currentUser
                    };

                    if (editingClient) {
                        // UPDATE
                        const { error } = await supabaseClient
                            .from('clients')
                            .update(data)
                            .eq('id', editingClient.id);
                        
                        if (error) throw error;
                        alert('Client updated!');
                        setEditingClient(null);
                    } else {
                        // ADD NEW
                        const { error } = await supabaseClient
                            .from('clients')
                            .insert([data]);
                        
                        if (error) throw error;
                        alert('Client added!');
                    }

                    // Reset form
                    setClientForm({
                        name: '',
                        phone: '',
                        looking_for: [],
                        locations: [],
                        moving_date: '',
                        nationality: '',
                        occupation: '',
                        how_many_people: 1,
                        pets: false,
                        let_type: 'Long Let',
                        budget: '',
                        min_bedrooms: 1,
                        max_bedrooms: 3,
                        other_requirements: '',
                        notes: ''
                    });
                    
                    fetchAllData();
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error: ' + error.message);
                }
                setLoading(false);
            }

            // ===== DELETE =====
            async function handleDelete(id, table) {
                if (!confirm('Are you sure?')) return;
                
                setLoading(true);
                try {
                    const { error } = await supabaseClient
                        .from(table)
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    alert('Deleted!');
                    fetchAllData();
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error: ' + error.message);
                }
                setLoading(false);
            }

            // ===== EDIT HANDLERS =====
            function handleEditProperty(prop) {
                setEditingProperty(prop);
                setPropForm({
                    reference_number: prop.reference_number,
                    type: prop.type,
                    bedrooms: prop.bedrooms,
                    available_from: prop.available_from,
                    price_per_month: prop.price_per_month,
                    negotiable: prop.negotiable,
                    location: prop.location,
                    notes: prop.notes || ''
                });
                setActiveTab('add-property');
            }

            function handleEditClient(client) {
                setEditingClient(client);
                setClientForm({
                    name: client.name,
                    phone: client.phone,
                    looking_for: client.looking_for,
                    locations: client.locations,
                    moving_date: client.moving_date,
                    nationality: client.nationality,
                    occupation: client.occupation,
                    how_many_people: client.how_many_people,
                    pets: client.pets,
                    let_type: client.let_type,
                    budget: client.budget,
                    min_bedrooms: client.min_bedrooms,
                    max_bedrooms: client.max_bedrooms,
                    other_requirements: client.other_requirements || '',
                    notes: client.notes || ''
                });
                setActiveTab('add-client');
            }

            // ===== RENDER =====
            return (
                <div className="flex h-full">
                    {/* SIDEBAR */}
                    <div className="sidebar w-64 flex-shrink-0 p-6">
                        <div className="mb-8">
                            <h1 className="text-2xl font-bold mb-2">Malta RE PRO</h1>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setCurrentUser('Gabriel QL')}
                                    className={`px-3 py-1 rounded-lg text-xs ${currentUser === 'Gabriel QL' ? 'badge-gabriel' : 'bg-gray-700'}`}
                                >
                                    Gabriel QL
                                </button>
                                <button
                                    onClick={() => setCurrentUser('Georgiana QL')}
                                    className={`px-3 py-1 rounded-lg text-xs ${currentUser === 'Georgiana QL' ? 'badge-georgiana' : 'bg-gray-700'}`}
                                >
                                    Georgiana QL
                                </button>
                            </div>
                        </div>

                        <nav className="space-y-2">
                            {[
                                { id: 'dashboard', icon: 'home', label: 'Dashboard' },
                                { id: 'properties', icon: 'building', label: 'Properties' },
                                { id: 'clients', icon: 'users', label: 'Clients' },
                                { id: 'matches', icon: 'zap', label: 'Smart Matches' },
                                { id: 'add-property', icon: 'plus-circle', label: 'Add Property' },
                                { id: 'add-client', icon: 'user-plus', label: 'Add Client' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition ${
                                        activeTab === tab.id ? 'tab-active' : 'hover:bg-slate-700'
                                    }`}
                                >
                                    <i data-lucide={tab.icon} className="w-5 h-5"></i>
                                    <span>{tab.label}</span>
                                </button>
                            ))}
                        </nav>
                    </div>

                    {/* MAIN CONTENT */}
                    <div className="flex-1 overflow-y-auto p-8">
                        {loading && (
                            <div className="flex items-center justify-center h-full">
                                <div className="text-center">
                                    <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-orange-500 mx-auto mb-4"></div>
                                    <p>Loading...</p>
                                </div>
                            </div>
                        )}

                        {!loading && activeTab === 'dashboard' && (
                            <Dashboard 
                                properties={properties} 
                                clients={clients} 
                                matches={matches}
                            />
                        )}

                        {!loading && activeTab === 'properties' && (
                            <PropertiesList 
                                properties={properties} 
                                onDelete={handleDelete}
                                onEdit={handleEditProperty}
                            />
                        )}

                        {!loading && activeTab === 'clients' && (
                            <ClientsList 
                                clients={clients} 
                                onDelete={handleDelete}
                                onEdit={handleEditClient}
                            />
                        )}

                        {!loading && activeTab === 'matches' && (
                            <MatchesList matches={matches} />
                        )}

                        {!loading && activeTab === 'add-property' && (
                            <AddPropertyForm 
                                form={propForm}
                                setForm={setPropForm}
                                onSubmit={handlePropertySubmit}
                                currentUser={currentUser}
                                editing={editingProperty}
                                onCancel={() => {
                                    setEditingProperty(null);
                                    setPropForm({
                                        reference_number: '',
                                        type: 'Apartment',
                                        bedrooms: 1,
                                        available_from: '',
                                        price_per_month: '',
                                        negotiable: false,
                                        location: '',
                                        notes: ''
                                    });
                                }}
                            />
                        )}

                        {!loading && activeTab === 'add-client' && (
                            <AddClientForm 
                                form={clientForm}
                                setForm={setClientForm}
                                onSubmit={handleClientSubmit}
                                currentUser={currentUser}
                                editing={editingClient}
                                onCancel={() => {
                                    setEditingClient(null);
                                    setClientForm({
                                        name: '',
                                        phone: '',
                                        looking_for: [],
                                        locations: [],
                                        moving_date: '',
                                        nationality: '',
                                        occupation: '',
                                        how_many_people: 1,
                                        pets: false,
                                        let_type: 'Long Let',
                                        budget: '',
                                        min_bedrooms: 1,
                                        max_bedrooms: 3,
                                        other_requirements: '',
                                        notes: ''
                                    });
                                }}
                            />
                        )}
                    </div>
                </div>
            );
        }

        // ===== DASHBOARD =====
        function Dashboard({ properties, clients, matches }) {
            return (
                <div>
                    <h2 className="text-3xl font-bold mb-8">Dashboard</h2>
                    
                    {/* STATS */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="card rounded-xl p-6">
                            <h3 className="text-gray-400 text-sm mb-2">Total Properties</h3>
                            <p className="text-4xl font-bold text-orange-500">{properties.length}</p>
                        </div>
                        <div className="card rounded-xl p-6">
                            <h3 className="text-gray-400 text-sm mb-2">Total Clients</h3>
                            <p className="text-4xl font-bold text-teal-500">{clients.length}</p>
                        </div>
                        <div className="card rounded-xl p-6">
                            <h3 className="text-gray-400 text-sm mb-2">Smart Matches</h3>
                            <p className="text-4xl font-bold text-green-500">{matches.length}</p>
                        </div>
                    </div>

                    {/* TOP MATCHES */}
                    <div className="card rounded-xl p-6">
                        <h3 className="text-xl font-bold mb-4">üî• Top Matches</h3>
                        {matches.slice(0, 5).map((match, idx) => (
                            <div key={idx} className="flex items-center justify-between p-4 mb-3 bg-slate-800 rounded-lg">
                                <div className="flex-1">
                                    <h4 className="font-semibold">{match.property.reference_number} - {match.property.type}</h4>
                                    <p className="text-sm text-gray-400">{match.client.name}</p>
                                </div>
                                <div className="match-score text-white px-4 py-2 rounded-lg font-bold">
                                    {match.scores.total}%
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ===== PROPERTIES LIST (NEW CLEAN DESIGN) =====
        function PropertiesList({ properties, onDelete, onEdit }) {
            return (
                <div>
                    <h2 className="text-3xl font-bold mb-8">Properties ({properties.length})</h2>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {properties.map(prop => (
                            <div key={prop.id} className="card rounded-lg p-5">
                                {/* HEADER - REF + BADGE + PRICE */}
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="text-xl font-bold mb-1">{prop.reference_number}</h3>
                                        <span className={`badge ${prop.added_by === 'Gabriel QL' ? 'badge-gabriel' : 'badge-georgiana'}`}>
                                            {prop.added_by}
                                        </span>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-2xl font-bold text-orange-500">‚Ç¨{prop.price_per_month}</div>
                                        <div className="text-xs text-gray-400">per month</div>
                                        {prop.negotiable && <span className="text-xs text-green-400">‚úì Negotiable</span>}
                                    </div>
                                </div>

                                {/* KEY INFO ROW */}
                                <div className="info-row">
                                    <div className="info-item">
                                        <div className="info-label">Type</div>
                                        <div className="info-value text-base">{prop.type}</div>
                                    </div>
                                    <div className="info-item">
                                        <div className="info-label">Beds</div>
                                        <div className="info-value">{prop.bedrooms}</div>
                                    </div>
                                    <div className="info-item">
                                        <div className="info-label">Location</div>
                                        <div className="info-value text-sm">{prop.location}</div>
                                    </div>
                                    <div className="info-item">
                                        <div className="info-label">Available</div>
                                        <div className="info-value text-xs">{new Date(prop.available_from).toLocaleDateString()}</div>
                                    </div>
                                </div>

                                {/* NOTES */}
                                {prop.notes && (
                                    <div className="mb-4 p-3 bg-slate-800 rounded text-sm text-gray-300">
                                        üìù {prop.notes}
                                    </div>
                                )}

                                {/* ACTIONS */}
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => onEdit(prop)}
                                        className="flex-1 px-4 py-2 btn-edit rounded-lg text-sm font-semibold"
                                    >
                                        ‚úèÔ∏è Edit
                                    </button>
                                    <button 
                                        onClick={() => onDelete(prop.id, 'properties')}
                                        className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700"
                                    >
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ===== CLIENTS LIST (NEW CLEAN DESIGN) =====
        function ClientsList({ clients, onDelete, onEdit }) {
            return (
                <div>
                    <h2 className="text-3xl font-bold mb-8">Clients ({clients.length})</h2>
                    
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {clients.map(client => (
                            <div key={client.id} className="card rounded-lg p-5">
                                {/* HEADER - NAME + BADGE + BUDGET */}
                                <div className="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 className="text-xl font-bold mb-1">{client.name}</h3>
                                        <span className={`badge ${client.added_by === 'Gabriel QL' ? 'badge-gabriel' : 'badge-georgiana'}`}>
                                            {client.added_by}
                                        </span>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-2xl font-bold text-teal-500">‚Ç¨{client.budget}</div>
                                        <div className="text-xs text-gray-400">budget</div>
                                    </div>
                                </div>

                                {/* KEY INFO ROW */}
                                <div className="info-row">
                                    <div className="info-item">
                                        <div className="info-label">Phone</div>
                                        <div className="info-value text-xs">{client.phone}</div>
                                    </div>
                                    <div className="info-item">
                                        <div className="info-label">Beds</div>
                                        <div className="info-value">{client.min_bedrooms}-{client.max_bedrooms}</div>
                                    </div>
                                    <div className="info-item">
                                        <div className="info-label">People</div>
                                        <div className="info-value">{client.how_many_people}</div>
                                    </div>
                                    <div className="info-item">
                                        <div className="info-label">Moving</div>
                                        <div className="info-value text-xs">{new Date(client.moving_date).toLocaleDateString()}</div>
                                    </div>
                                </div>

                                {/* DETAILS */}
                                <div className="space-y-2 mb-4 text-sm">
                                    <div className="flex flex-wrap gap-1">
                                        <span className="text-gray-400">Looking for:</span>
                                        {client.looking_for.map(type => (
                                            <span key={type} className="bg-orange-500/20 text-orange-400 px-2 py-0.5 rounded text-xs">
                                                {type}
                                            </span>
                                        ))}
                                    </div>
                                    <div className="flex flex-wrap gap-1">
                                        <span className="text-gray-400">Locations:</span>
                                        {client.locations.map(loc => (
                                            <span key={loc} className="bg-teal-500/20 text-teal-400 px-2 py-0.5 rounded text-xs">
                                                {loc}
                                            </span>
                                        ))}
                                    </div>
                                    <p className="text-gray-400">
                                        üåç {client.nationality} ‚Ä¢ üíº {client.occupation} ‚Ä¢ 
                                        {client.pets ? ' üêæ Pets' : ' ‚ùå No pets'} ‚Ä¢ 
                                        üìÖ {client.let_type}
                                    </p>
                                </div>

                                {/* NOTES */}
                                {client.notes && (
                                    <div className="mb-4 p-3 bg-slate-800 rounded text-sm text-gray-300">
                                        üìù {client.notes}
                                    </div>
                                )}

                                {/* OTHER REQUIREMENTS */}
                                {client.other_requirements && (
                                    <div className="mb-4 p-3 bg-slate-800 rounded text-sm text-gray-300">
                                        ‚ö†Ô∏è {client.other_requirements}
                                    </div>
                                )}

                                {/* ACTIONS */}
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => onEdit(client)}
                                        className="flex-1 px-4 py-2 btn-edit rounded-lg text-sm font-semibold"
                                    >
                                        ‚úèÔ∏è Edit
                                    </button>
                                    <button 
                                        onClick={() => onDelete(client.id, 'clients')}
                                        className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700"
                                    >
                                        üóëÔ∏è Delete
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ===== MATCHES LIST =====
        function MatchesList({ matches }) {
            return (
                <div>
                    <h2 className="text-3xl font-bold mb-8">Smart Matches ({matches.length})</h2>
                    
                    <div className="space-y-6">
                        {matches.map((match, idx) => (
                            <div key={idx} className="card rounded-xl p-6">
                                <div className="flex items-start justify-between mb-4">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-3 mb-2">
                                            <h3 className="text-xl font-bold">{match.property.reference_number}</h3>
                                            <span className="match-score text-white px-4 py-2 rounded-full font-bold">
                                                {match.scores.total}% Match
                                            </span>
                                        </div>
                                        <p className="text-gray-400">{match.client.name}</p>
                                    </div>
                                </div>

                                {/* Match Score Breakdown */}
                                <div className="grid grid-cols-4 gap-4 mb-6">
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-blue-400">{match.scores.price}%</div>
                                        <div className="text-xs text-gray-400">Price</div>
                                        <div className="text-xs text-gray-500">‚Ç¨{match.scores.priceDiff} diff</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-green-400">{match.scores.location}%</div>
                                        <div className="text-xs text-gray-400">Location</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-purple-400">{match.scores.type}%</div>
                                        <div className="text-xs text-gray-400">Type</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-orange-400">{match.scores.bedroom}%</div>
                                        <div className="text-xs text-gray-400">Bedrooms</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 className="font-semibold mb-2 text-orange-500">Property</h4>
                                        <div className="space-y-1 text-sm">
                                            <p>üè† {match.property.type} ‚Ä¢ {match.property.bedrooms} beds</p>
                                            <p>üí∞ ‚Ç¨{match.property.price_per_month}/mo {match.property.negotiable && '(Negotiable)'}</p>
                                            <p>üìç {match.property.location}</p>
                                            <p>üìÖ Available: {new Date(match.property.available_from).toLocaleDateString()}</p>
                                        </div>
                                    </div>

                                    <div>
                                        <h4 className="font-semibold mb-2 text-teal-500">Client</h4>
                                        <div className="space-y-1 text-sm">
                                            <p>üìû {match.client.phone}</p>
                                            <p>üí∞ Budget: ‚Ç¨{match.client.budget}/mo</p>
                                            <p>üìç {match.client.locations.join(', ')}</p>
                                            <p>üè† Looking for: {match.client.looking_for.join(', ')}</p>
                                            <p>üõèÔ∏è {match.client.min_bedrooms}-{match.client.max_bedrooms} beds</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        // ===== ADD PROPERTY FORM =====
        function AddPropertyForm({ form, setForm, onSubmit, currentUser, editing, onCancel }) {
            return (
                <div>
                    <h2 className="text-3xl font-bold mb-8">
                        {editing ? '‚úèÔ∏è Edit Property' : '‚ûï Add Property'}
                    </h2>
                    
                    <form onSubmit={onSubmit} className="glass rounded-xl p-8 max-w-3xl">
                        <div className="mb-4">
                            <span className={`badge ${currentUser === 'Gabriel QL' ? 'badge-gabriel' : 'badge-georgiana'}`}>
                                Added by: {currentUser}
                            </span>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-semibold mb-2">Reference Number *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.reference_number}
                                    onChange={e => setForm({...form, reference_number: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="REF-001"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Type *</label>
                                <select
                                    value={form.type}
                                    onChange={e => setForm({...form, type: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                >
                                    {PROPERTY_TYPES.map(type => <option key={type}>{type}</option>)}
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Bedrooms *</label>
                                <input
                                    type="number"
                                    required
                                    min="1"
                                    value={form.bedrooms}
                                    onChange={e => setForm({...form, bedrooms: parseInt(e.target.value)})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Available From *</label>
                                <input
                                    type="date"
                                    required
                                    value={form.available_from}
                                    onChange={e => setForm({...form, available_from: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Price per Month (‚Ç¨) *</label>
                                <input
                                    type="number"
                                    required
                                    value={form.price_per_month}
                                    onChange={e => setForm({...form, price_per_month: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="1200"
                                />
                            </div>

                            <div className="flex items-center gap-3">
                                <input
                                    type="checkbox"
                                    id="negotiable"
                                    checked={form.negotiable}
                                    onChange={e => setForm({...form, negotiable: e.target.checked})}
                                    className="w-5 h-5"
                                />
                                <label htmlFor="negotiable" className="text-sm font-semibold">Price Negotiable</label>
                            </div>

                            <div className="md:col-span-2">
                                <label className="block text-sm font-semibold mb-2">Location *</label>
                                <LocationAutocomplete
                                    value={form.location}
                                    onChange={(loc) => setForm({...form, location: loc})}
                                    placeholder="Start typing location..."
                                />
                            </div>

                            <div className="md:col-span-2">
                                <label className="block text-sm font-semibold mb-2">Notes / Requirements</label>
                                <textarea
                                    value={form.notes}
                                    onChange={e => setForm({...form, notes: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    rows="4"
                                    placeholder="Additional information..."
                                />
                            </div>
                        </div>

                        <div className="flex gap-4 mt-8">
                            <button
                                type="submit"
                                className="flex-1 btn-primary text-white px-8 py-3 rounded-lg font-semibold"
                            >
                                {editing ? 'üíæ Update Property' : '‚ûï Add Property'}
                            </button>
                            {editing && (
                                <button
                                    type="button"
                                    onClick={onCancel}
                                    className="px-8 py-3 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700"
                                >
                                    ‚ùå Cancel
                                </button>
                            )}
                        </div>
                    </form>
                </div>
            );
        }

        // ===== ADD CLIENT FORM =====
        function AddClientForm({ form, setForm, onSubmit, currentUser, editing, onCancel }) {
            const [lookingForInput, setLookingForInput] = useState('');

            const addLookingFor = (type) => {
                if (!form.looking_for.includes(type)) {
                    setForm({...form, looking_for: [...form.looking_for, type]});
                }
                setLookingForInput('');
            };

            const removeLookingFor = (type) => {
                setForm({...form, looking_for: form.looking_for.filter(t => t !== type)});
            };

            return (
                <div>
                    <h2 className="text-3xl font-bold mb-8">
                        {editing ? '‚úèÔ∏è Edit Client' : '‚ûï Add Client'}
                    </h2>
                    
                    <form onSubmit={onSubmit} className="glass rounded-xl p-8 max-w-3xl">
                        <div className="mb-4">
                            <span className={`badge ${currentUser === 'Gabriel QL' ? 'badge-gabriel' : 'badge-georgiana'}`}>
                                Added by: {currentUser}
                            </span>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block text-sm font-semibold mb-2">Name *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.name}
                                    onChange={e => setForm({...form, name: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="John Smith"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Phone *</label>
                                <input
                                    type="tel"
                                    required
                                    value={form.phone}
                                    onChange={e => setForm({...form, phone: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="+356 9999 1111"
                                />
                            </div>

                            <div className="md:col-span-2">
                                <label className="block text-sm font-semibold mb-2">Looking For (Property Types) *</label>
                                {form.looking_for.length > 0 && (
                                    <div className="flex flex-wrap gap-2 mb-2">
                                        {form.looking_for.map(type => (
                                            <span key={type} className="bg-orange-500 text-white px-3 py-1 rounded-full text-sm flex items-center gap-2">
                                                {type}
                                                <button type="button" onClick={() => removeLookingFor(type)} className="hover:text-red-200">√ó</button>
                                            </span>
                                        ))}
                                    </div>
                                )}
                                <div className="relative">
                                    <input
                                        type="text"
                                        value={lookingForInput}
                                        onChange={e => setLookingForInput(e.target.value)}
                                        className="input-field w-full px-4 py-3 rounded-lg"
                                        placeholder="Start typing property type..."
                                    />
                                    {lookingForInput.length > 0 && (
                                        <div className="autocomplete-dropdown w-full">
                                            {PROPERTY_TYPES
                                                .filter(type => type.toLowerCase().includes(lookingForInput.toLowerCase()) && !form.looking_for.includes(type))
                                                .map(type => (
                                                    <div
                                                        key={type}
                                                        onClick={() => addLookingFor(type)}
                                                        className="autocomplete-item"
                                                    >
                                                        {type}
                                                    </div>
                                                ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="md:col-span-2">
                                <label className="block text-sm font-semibold mb-2">Preferred Locations (Multiple) *</label>
                                <LocationAutocomplete
                                    value={form.locations}
                                    onChange={(locs) => setForm({...form, locations: locs})}
                                    multiple={true}
                                    placeholder="Start typing location..."
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Moving Date *</label>
                                <input
                                    type="date"
                                    required
                                    value={form.moving_date}
                                    onChange={e => setForm({...form, moving_date: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Nationality *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.nationality}
                                    onChange={e => setForm({...form, nationality: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="British"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Occupation *</label>
                                <input
                                    type="text"
                                    required
                                    value={form.occupation}
                                    onChange={e => setForm({...form, occupation: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="Software Engineer"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">How Many People *</label>
                                <input
                                    type="number"
                                    required
                                    min="1"
                                    value={form.how_many_people}
                                    onChange={e => setForm({...form, how_many_people: parseInt(e.target.value)})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                />
                            </div>

                            <div className="flex items-center gap-3">
                                <input
                                    type="checkbox"
                                    id="pets"
                                    checked={form.pets}
                                    onChange={e => setForm({...form, pets: e.target.checked})}
                                    className="w-5 h-5"
                                />
                                <label htmlFor="pets" className="text-sm font-semibold">Has Pets</label>
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Let Type *</label>
                                <select
                                    value={form.let_type}
                                    onChange={e => setForm({...form, let_type: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                >
                                    <option>Long Let</option>
                                    <option>Short Let</option>
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Budget (‚Ç¨/month) *</label>
                                <input
                                    type="number"
                                    required
                                    value={form.budget}
                                    onChange={e => setForm({...form, budget: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    placeholder="1300"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Min Bedrooms *</label>
                                <input
                                    type="number"
                                    required
                                    min="1"
                                    value={form.min_bedrooms}
                                    onChange={e => setForm({...form, min_bedrooms: parseInt(e.target.value)})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-semibold mb-2">Max Bedrooms</label>
                                <input
                                    type="number"
                                    min={form.min_bedrooms}
                                    value={form.max_bedrooms}
                                    onChange={e => setForm({...form, max_bedrooms: parseInt(e.target.value)})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                />
                            </div>

                            <div className="md:col-span-2">
                                <label className="block text-sm font-semibold mb-2">Other Requirements</label>
                                <textarea
                                    value={form.other_requirements}
                                    onChange={e => setForm({...form, other_requirements: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    rows="3"
                                    placeholder="Parking space, balcony, etc."
                                />
                            </div>

                            <div className="md:col-span-2">
                                <label className="block text-sm font-semibold mb-2">Notes</label>
                                <textarea
                                    value={form.notes}
                                    onChange={e => setForm({...form, notes: e.target.value})}
                                    className="input-field w-full px-4 py-3 rounded-lg"
                                    rows="4"
                                    placeholder="General notes about the client..."
                                />
                            </div>
                        </div>

                        <div className="flex gap-4 mt-8">
                            <button
                                type="submit"
                                className="flex-1 btn-primary text-white px-8 py-3 rounded-lg font-semibold"
                            >
                                {editing ? 'üíæ Update Client' : '‚ûï Add Client'}
                            </button>
                            {editing && (
                                <button
                                    type="button"
                                    onClick={onCancel}
                                    className="px-8 py-3 bg-gray-600 text-white rounded-lg font-semibold hover:bg-gray-700"
                                >
                                    ‚ùå Cancel
                                </button>
                            )}
                        </div>
                    </form>
                </div>
            );
        }

        // ===== MOUNT APP =====
        ReactDOM.render(<App />, document.getElementById('root'));
        setTimeout(() => lucide.createIcons(), 500);
    </script>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => console.log('‚úÖ Service Worker registered'))
                .catch(err => console.error('‚ùå SW error:', err));
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malta Real Estate PRO</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#0f172a">
    <link rel="icon" type="image/png" href="./icon-192.png">
    <meta name="description" content="Professional real estate management platform for Malta">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Leaflet for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- React & Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --accent-primary: #f59e0b;
            --accent-secondary: #10b981;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --info: #3b82f6;
        }
        
        .light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            line-height: 1.2;
        }
        
        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Header */
        .app-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0 1.5rem;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            font-family: 'Outfit', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.25rem;
            border-radius: 12px;
        }
        
        .nav-tab {
            padding: 0.6rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }
        
        .nav-tab.active {
            background: var(--accent-primary);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem 1.5rem;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px var(--shadow);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px var(--shadow);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Inter', sans-serif;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #d97706;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        
        .btn-secondary:hover {
            background: var(--border);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-icon {
            padding: 0.6rem;
            border-radius: 8px;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Outfit', sans-serif;
            color: var(--text-primary);
        }
        
        .stat-change {
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .stat-change.positive {
            color: var(--success);
        }
        
        .stat-change.negative {
            color: var(--danger);
        }
        
        /* Property/Client List Items */
        .list-item {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .list-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(4px);
        }
        
        .list-item-content {
            flex: 1;
        }
        
        .list-item-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .list-item-subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .list-item-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .badge-info {
            background: rgba(59, 130, 246, 0.15);
            color: var(--info);
        }
        
        /* Map Container */
        .map-container {
            height: 500px;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        /* Match Score */
        .match-score {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .match-score-icon {
            font-size: 1.2rem;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            backdrop-filter: blur(4px);
        }
        
        .modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 1.5rem;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.375rem;
            top: 0.25rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-primary);
            border: 3px solid var(--bg-secondary);
        }
        
        .timeline-content {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
        }
        
        .timeline-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-header {
                padding: 0 1rem;
                height: 60px;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .nav-tabs {
                display: none;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }
        }
        
        /* Dark Mode Toggle */
        .theme-toggle {
            width: 50px;
            height: 26px;
            background: var(--bg-tertiary);
            border-radius: 13px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .theme-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        
        .light-mode .theme-toggle-slider {
            transform: translateX(24px);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://sqjmckqxodlhmjhplsfr.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxam1ja3F4b2RsaG1qaHBsc2ZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg1MzEzODUsImV4cCI6MjA1NDEwNzM4NX0.6Fuf1nPCdv7V8NUhW2Pt43LKi7Sm-3g2V3Zk9sAOdOI';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Malta Zones with coordinates
        const MALTA_ZONES = {
            'Sliema': { lat: 35.9120, lng: 14.5015, nearby: ['St. Julians', 'Gzira', 'Msida', 'Ta\' Xbiex'] },
            'St. Julians': { lat: 35.9186, lng: 14.4897, nearby: ['Sliema', 'Paceville', 'Swieqi'] },
            'Valletta': { lat: 35.8989, lng: 14.5146, nearby: ['Floriana', 'Hamrun', 'Msida'] },
            'Mdina': { lat: 35.8869, lng: 14.4035, nearby: ['Rabat', 'Attard', 'Balzan'] },
            'Mellieha': { lat: 35.9574, lng: 14.3622, nearby: ['St. Paul\'s Bay', 'Mgarr'] },
            'Marsaxlokk': { lat: 35.8419, lng: 14.5431, nearby: ['Birzebbuga', 'Zejtun'] },
            'Gozo': { lat: 36.0444, lng: 14.2417, nearby: ['Victoria', 'Rabat'] }
        };
        
        // Smart Matching Algorithm
        const calculateMatch = (property, client) => {
            let score = 0;
            let reasons = [];
            
            // Price match with negotiation tolerance (¬±15%)
            if (property.price && client.budget) {
                const priceDiff = Math.abs(property.price - client.budget);
                const tolerance = client.budget * 0.15;
                
                if (priceDiff <= tolerance) {
                    const priceScore = 40 * (1 - priceDiff / tolerance);
                    score += priceScore;
                    if (priceDiff < client.budget * 0.05) {
                        reasons.push('Perfect price match');
                    } else {
                        reasons.push('Price negotiable');
                    }
                }
            }
            
            // Location match (exact + nearby)
            if (property.location && client.preferred_location) {
                if (property.location === client.preferred_location) {
                    score += 30;
                    reasons.push('Exact location match');
                } else {
                    const propZone = MALTA_ZONES[property.location];
                    if (propZone && propZone.nearby.includes(client.preferred_location)) {
                        score += 20;
                        reasons.push('Nearby location');
                    }
                }
            }
            
            // Property type match
            if (property.type === client.looking_for) {
                score += 20;
                reasons.push('Property type match');
            }
            
            // Bedrooms match
            if (property.bedrooms && client.min_bedrooms) {
                if (property.bedrooms >= client.min_bedrooms) {
                    score += 10;
                    reasons.push('Bedrooms requirement met');
                }
            }
            
            return {
                score: Math.round(score),
                reasons,
                isMatch: score >= 50 // 50% threshold for match
            };
        };
        
        // Main App Component
        function App() {
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [theme, setTheme] = useState('dark');
            const [properties, setProperties] = useState([]);
            const [clients, setClients] = useState([]);
            const [reminders, setReminders] = useState([]);
            const [matches, setMatches] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [modalType, setModalType] = useState('');
            const [selectedItem, setSelectedItem] = useState(null);
            
            // Toggle theme
            const toggleTheme = () => {
                setTheme(prev => prev === 'dark' ? 'light' : 'dark');
            };
            
            useEffect(() => {
                document.body.className = theme === 'light' ? 'light-mode' : '';
            }, [theme]);
            
            // Load data
            useEffect(() => {
                loadData();
            }, []);
            
            const loadData = async () => {
                try {
                    const [propsRes, clientsRes, remindersRes] = await Promise.all([
                        supabase.from('properties').select('*'),
                        supabase.from('clients').select('*'),
                        supabase.from('reminders').select('*')
                    ]);
                    
                    if (propsRes.data) setProperties(propsRes.data);
                    if (clientsRes.data) setClients(clientsRes.data);
                    if (remindersRes.data) setReminders(remindersRes.data);
                    
                    // Calculate matches
                    if (propsRes.data && clientsRes.data) {
                        calculateAllMatches(propsRes.data, clientsRes.data);
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    setLoading(false);
                }
            };
            
            const calculateAllMatches = (props, cls) => {
                const allMatches = [];
                cls.forEach(client => {
                    props.forEach(property => {
                        const match = calculateMatch(property, client);
                        if (match.isMatch) {
                            allMatches.push({
                                ...match,
                                client,
                                property,
                                id: `${client.id}-${property.id}`
                            });
                        }
                    });
                });
                // Sort by score descending
                allMatches.sort((a, b) => b.score - a.score);
                setMatches(allMatches);
            };
            
            const openModal = (type, item = null) => {
                setModalType(type);
                setSelectedItem(item);
                setShowModal(true);
            };
            
            const closeModal = () => {
                setShowModal(false);
                setModalType('');
                setSelectedItem(null);
            };
            
            if (loading) {
                return (
                    <div className="loading-screen">
                        <div className="loading-spinner"></div>
                    </div>
                );
            }
            
            return (
                <>
                    <header className="app-header">
                        <div className="logo">
                            <div className="logo-icon">üè†</div>
                            <span>Malta RE PRO</span>
                        </div>
                        
                        <div className="header-actions">
                            <nav className="nav-tabs">
                                <button 
                                    className={`nav-tab ${activeTab === 'dashboard' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('dashboard')}
                                >
                                    Dashboard
                                </button>
                                <button 
                                    className={`nav-tab ${activeTab === 'properties' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('properties')}
                                >
                                    Properties
                                </button>
                                <button 
                                    className={`nav-tab ${activeTab === 'clients' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('clients')}
                                >
                                    Clients
                                </button>
                                <button 
                                    className={`nav-tab ${activeTab === 'matches' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('matches')}
                                >
                                    Smart Matches
                                </button>
                                <button 
                                    className={`nav-tab ${activeTab === 'map' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('map')}
                                >
                                    Map
                                </button>
                            </nav>
                            
                            <div className="theme-toggle" onClick={toggleTheme}>
                                <div className="theme-toggle-slider"></div>
                            </div>
                        </div>
                    </header>
                    
                    <main className="main-content">
                        {activeTab === 'dashboard' && (
                            <DashboardView 
                                properties={properties}
                                clients={clients}
                                matches={matches}
                                reminders={reminders}
                                openModal={openModal}
                            />
                        )}
                        
                        {activeTab === 'properties' && (
                            <PropertiesView 
                                properties={properties}
                                openModal={openModal}
                                reload={loadData}
                            />
                        )}
                        
                        {activeTab === 'clients' && (
                            <ClientsView 
                                clients={clients}
                                openModal={openModal}
                                reload={loadData}
                            />
                        )}
                        
                        {activeTab === 'matches' && (
                            <MatchesView 
                                matches={matches}
                                openModal={openModal}
                            />
                        )}
                        
                        {activeTab === 'map' && (
                            <MapView 
                                properties={properties}
                                clients={clients}
                            />
                        )}
                    </main>
                    
                    {showModal && (
                        <ModalComponent 
                            type={modalType}
                            item={selectedItem}
                            onClose={closeModal}
                            reload={loadData}
                        />
                    )}
                </>
            );
        }
        
        // Dashboard View
        function DashboardView({ properties, clients, matches, reminders, openModal }) {
            const activeProperties = properties.filter(p => p.status === 'available').length;
            const activeClients = clients.filter(c => c.status === 'active').length;
            const totalMatches = matches.length;
            const pendingReminders = reminders.filter(r => !r.completed).length;
            
            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                        <h1 style={{ fontSize: '2rem', fontFamily: 'Outfit' }}>Dashboard</h1>
                        <button className="btn btn-primary" onClick={() => openModal('quick-add')}>
                            ‚ûï Quick Add
                        </button>
                    </div>
                    
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">Active Properties</div>
                            <div className="stat-value">{activeProperties}</div>
                            <div className="stat-change positive">‚Üó +{Math.floor(Math.random() * 5) + 1} this week</div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Active Clients</div>
                            <div className="stat-value">{activeClients}</div>
                            <div className="stat-change positive">‚Üó +{Math.floor(Math.random() * 3) + 1} this week</div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Smart Matches</div>
                            <div className="stat-value">{totalMatches}</div>
                            <div className="stat-change positive">üî• Ready to contact</div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-label">Pending Tasks</div>
                            <div className="stat-value">{pendingReminders}</div>
                            <div className="stat-change">üìÖ Due soon</div>
                        </div>
                    </div>
                    
                    <div className="grid grid-2" style={{ marginTop: '2rem' }}>
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">üî• Top Matches</h3>
                                <button className="btn btn-secondary btn-icon" onClick={() => openModal('matches')}>‚Üí</button>
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {matches.slice(0, 3).map(match => (
                                    <div key={match.id} className="list-item">
                                        <div className="list-item-content">
                                            <div className="list-item-title">
                                                {match.client.name} ‚Üî {match.property.title}
                                            </div>
                                            <div className="list-item-subtitle">
                                                {match.reasons.join(' ‚Ä¢ ')}
                                            </div>
                                        </div>
                                        <div className="match-score">
                                            <span className="match-score-icon">üéØ</span>
                                            {match.score}%
                                        </div>
                                    </div>
                                ))}
                                {matches.length === 0 && (
                                    <p style={{ color: 'var(--text-muted)', textAlign: 'center', padding: '2rem' }}>
                                        No matches yet. Add properties and clients to see smart matches!
                                    </p>
                                )}
                            </div>
                        </div>
                        
                        <div className="card">
                            <div className="card-header">
                                <h3 className="card-title">‚è∞ Upcoming Tasks</h3>
                                <button className="btn btn-secondary btn-icon" onClick={() => openModal('add-reminder')}>+</button>
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {reminders.filter(r => !r.completed).slice(0, 5).map(reminder => (
                                    <div key={reminder.id} className="list-item">
                                        <div className="list-item-content">
                                            <div className="list-item-title">{reminder.title}</div>
                                            <div className="list-item-subtitle">{reminder.due_date}</div>
                                        </div>
                                        <span className={`badge badge-${reminder.priority === 'high' ? 'danger' : reminder.priority === 'medium' ? 'warning' : 'info'}`}>
                                            {reminder.priority}
                                        </span>
                                    </div>
                                ))}
                                {reminders.filter(r => !r.completed).length === 0 && (
                                    <p style={{ color: 'var(--text-muted)', textAlign: 'center', padding: '2rem' }}>
                                        All clear! No pending tasks.
                                    </p>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Properties View
        function PropertiesView({ properties, openModal, reload }) {
            const [filter, setFilter] = useState('all');
            
            const filteredProps = filter === 'all' 
                ? properties 
                : properties.filter(p => p.status === filter);
            
            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                        <h1 style={{ fontSize: '2rem', fontFamily: 'Outfit' }}>Properties</h1>
                        <button className="btn btn-primary" onClick={() => openModal('add-property')}>
                            ‚ûï Add Property
                        </button>
                    </div>
                    
                    <div style={{ marginBottom: '1.5rem', display: 'flex', gap: '0.5rem' }}>
                        <button 
                            className={`btn ${filter === 'all' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('all')}
                        >
                            All ({properties.length})
                        </button>
                        <button 
                            className={`btn ${filter === 'available' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('available')}
                        >
                            Available ({properties.filter(p => p.status === 'available').length})
                        </button>
                        <button 
                            className={`btn ${filter === 'sold' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('sold')}
                        >
                            Sold ({properties.filter(p => p.status === 'sold').length})
                        </button>
                    </div>
                    
                    <div className="grid grid-3">
                        {filteredProps.map(property => (
                            <div key={property.id} className="card">
                                <div style={{ marginBottom: '1rem' }}>
                                    <span className={`badge badge-${property.status === 'available' ? 'success' : 'danger'}`}>
                                        {property.status}
                                    </span>
                                </div>
                                <h3 style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}>{property.title}</h3>
                                <p style={{ color: 'var(--text-muted)', fontSize: '0.9rem', marginBottom: '1rem' }}>
                                    üìç {property.location} ‚Ä¢ {property.bedrooms} bed ‚Ä¢ {property.type}
                                </p>
                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--accent-primary)', marginBottom: '1rem' }}>
                                    ‚Ç¨{property.price?.toLocaleString()}
                                </div>
                                <button 
                                    className="btn btn-secondary" 
                                    style={{ width: '100%' }}
                                    onClick={() => openModal('view-property', property)}
                                >
                                    View Details ‚Üí
                                </button>
                            </div>
                        ))}
                    </div>
                    
                    {filteredProps.length === 0 && (
                        <div style={{ textAlign: 'center', padding: '4rem 0' }}>
                            <p style={{ color: 'var(--text-muted)', fontSize: '1.1rem' }}>
                                No properties found. Click "Add Property" to get started!
                            </p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Clients View
        function ClientsView({ clients, openModal, reload }) {
            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>
                        <h1 style={{ fontSize: '2rem', fontFamily: 'Outfit' }}>Clients</h1>
                        <button className="btn btn-primary" onClick={() => openModal('add-client')}>
                            ‚ûï Add Client
                        </button>
                    </div>
                    
                    <div className="grid grid-2">
                        {clients.map(client => (
                            <div key={client.id} className="card">
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '1rem' }}>
                                    <div>
                                        <h3 style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}>{client.name}</h3>
                                        <p style={{ color: 'var(--text-muted)', fontSize: '0.9rem' }}>
                                            üìß {client.email} ‚Ä¢ üìû {client.phone}
                                        </p>
                                    </div>
                                    <span className={`badge badge-${client.status === 'active' ? 'success' : 'info'}`}>
                                        {client.status}
                                    </span>
                                </div>
                                
                                <div style={{ background: 'var(--bg-primary)', padding: '1rem', borderRadius: '8px', marginBottom: '1rem' }}>
                                    <p style={{ fontSize: '0.85rem', color: 'var(--text-muted)', marginBottom: '0.5rem' }}>Looking for:</p>
                                    <p style={{ fontSize: '0.95rem' }}>
                                        {client.looking_for} in {client.preferred_location}<br />
                                        Budget: ‚Ç¨{client.budget?.toLocaleString()} ‚Ä¢ {client.min_bedrooms}+ beds
                                    </p>
                                </div>
                                
                                <button 
                                    className="btn btn-secondary" 
                                    style={{ width: '100%' }}
                                    onClick={() => openModal('view-client', client)}
                                >
                                    View Profile ‚Üí
                                </button>
                            </div>
                        ))}
                    </div>
                    
                    {clients.length === 0 && (
                        <div style={{ textAlign: 'center', padding: '4rem 0' }}>
                            <p style={{ color: 'var(--text-muted)', fontSize: '1.1rem' }}>
                                No clients yet. Click "Add Client" to start building your network!
                            </p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Matches View
        function MatchesView({ matches, openModal }) {
            return (
                <div>
                    <div style={{ marginBottom: '2rem' }}>
                        <h1 style={{ fontSize: '2rem', fontFamily: 'Outfit', marginBottom: '0.5rem' }}>üéØ Smart Matches</h1>
                        <p style={{ color: 'var(--text-muted)' }}>
                            Intelligent property-client matching with price negotiation tolerance and location proximity
                        </p>
                    </div>
                    
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                        {matches.map(match => (
                            <div key={match.id} className="card">
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: '2rem' }}>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '1rem', marginBottom: '1rem' }}>
                                            <div className="match-score">
                                                <span className="match-score-icon">üéØ</span>
                                                {match.score}%
                                            </div>
                                            <div>
                                                <h3 style={{ fontSize: '1.25rem', marginBottom: '0.25rem' }}>
                                                    {match.client.name} ‚Üî {match.property.title}
                                                </h3>
                                                <p style={{ color: 'var(--text-muted)', fontSize: '0.9rem' }}>
                                                    {match.reasons.join(' ‚Ä¢ ')}
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div className="grid grid-2" style={{ gap: '1rem' }}>
                                            <div style={{ background: 'var(--bg-primary)', padding: '1rem', borderRadius: '8px' }}>
                                                <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '0.5rem', textTransform: 'uppercase', fontWeight: '600' }}>Property</p>
                                                <p style={{ fontSize: '0.95rem', marginBottom: '0.5rem' }}>{match.property.title}</p>
                                                <p style={{ fontSize: '0.85rem', color: 'var(--text-muted)' }}>
                                                    üìç {match.property.location} ‚Ä¢ ‚Ç¨{match.property.price?.toLocaleString()}
                                                </p>
                                            </div>
                                            
                                            <div style={{ background: 'var(--bg-primary)', padding: '1rem', borderRadius: '8px' }}>
                                                <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginBottom: '0.5rem', textTransform: 'uppercase', fontWeight: '600' }}>Client</p>
                                                <p style={{ fontSize: '0.95rem', marginBottom: '0.5rem' }}>{match.client.name}</p>
                                                <p style={{ fontSize: '0.85rem', color: 'var(--text-muted)' }}>
                                                    üìû {match.client.phone} ‚Ä¢ Budget: ‚Ç¨{match.client.budget?.toLocaleString()}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                        <button className="btn btn-success">üìû Call</button>
                                        <button className="btn btn-primary">üìß Email</button>
                                        <button className="btn btn-secondary">üìÖ Schedule</button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {matches.length === 0 && (
                        <div style={{ textAlign: 'center', padding: '4rem 0' }}>
                            <p style={{ color: 'var(--text-muted)', fontSize: '1.1rem' }}>
                                No matches found. Add more properties and clients to see smart matches!
                            </p>
                        </div>
                    )}
                </div>
            );
        }
        
        // Map View
        function MapView({ properties, clients }) {
            useEffect(() => {
                // Initialize map
                const map = L.map('propertyMap').setView([35.9375, 14.3754], 11);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(map);
                
                // Add property markers
                properties.forEach(property => {
                    const zone = MALTA_ZONES[property.location];
                    if (zone) {
                        const marker = L.marker([zone.lat, zone.lng])
                            .addTo(map)
                            .bindPopup(`
                                <div style="font-family: Inter, sans-serif;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 1rem;">${property.title}</h3>
                                    <p style="margin: 4px 0; color: #666; font-size: 0.9rem;">
                                        ${property.bedrooms} bed ‚Ä¢ ${property.type}
                                    </p>
                                    <p style="margin: 8px 0 0 0; font-weight: 600; font-size: 1.1rem; color: #f59e0b;">
                                        ‚Ç¨${property.price?.toLocaleString()}
                                    </p>
                                </div>
                            `);
                    }
                });
                
                return () => {
                    map.remove();
                };
            }, [properties]);
            
            return (
                <div>
                    <div style={{ marginBottom: '2rem' }}>
                        <h1 style={{ fontSize: '2rem', fontFamily: 'Outfit', marginBottom: '0.5rem' }}>üó∫Ô∏è Property Map</h1>
                        <p style={{ color: 'var(--text-muted)' }}>
                            Interactive map showing all available properties in Malta
                        </p>
                    </div>
                    
                    <div id="propertyMap" className="map-container"></div>
                </div>
            );
        }
        
        // Modal Component
        function ModalComponent({ type, item, onClose, reload }) {
            const [formData, setFormData] = useState(item || {});
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                try {
                    if (type === 'add-property') {
                        await supabase.from('properties').insert([{
                            ...formData,
                            status: 'available',
                            created_at: new Date().toISOString()
                        }]);
                    } else if (type === 'add-client') {
                        await supabase.from('clients').insert([{
                            ...formData,
                            status: 'active',
                            created_at: new Date().toISOString()
                        }]);
                    } else if (type === 'add-reminder') {
                        await supabase.from('reminders').insert([{
                            ...formData,
                            completed: false,
                            created_at: new Date().toISOString()
                        }]);
                    }
                    
                    reload();
                    onClose();
                } catch (error) {
                    console.error('Error saving:', error);
                    alert('Error saving data. Please try again.');
                }
            };
            
            const handleChange = (e) => {
                const { name, value, type } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: type === 'number' ? parseFloat(value) : value
                }));
            };
            
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            <h2 className="modal-title">
                                {type === 'add-property' && 'üè† Add Property'}
                                {type === 'add-client' && 'üë§ Add Client'}
                                {type === 'add-reminder' && '‚è∞ Add Reminder'}
                                {type === 'view-property' && 'üè† Property Details'}
                                {type === 'view-client' && 'üë§ Client Profile'}
                            </h2>
                            <button className="btn btn-icon" onClick={onClose}>‚úï</button>
                        </div>
                        
                        <div className="modal-body">
                            {(type === 'add-property' || type === 'view-property') && (
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Title *</label>
                                        <input 
                                            type="text" 
                                            name="title"
                                            className="form-input"
                                            value={formData.title || ''}
                                            onChange={handleChange}
                                            required
                                            disabled={type === 'view-property'}
                                        />
                                    </div>
                                    
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Type *</label>
                                            <select 
                                                name="type"
                                                className="form-select"
                                                value={formData.type || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-property'}
                                            >
                                                <option value="">Select type</option>
                                                <option value="Apartment">Apartment</option>
                                                <option value="House">House</option>
                                                <option value="Villa">Villa</option>
                                                <option value="Commercial">Commercial</option>
                                            </select>
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Location *</label>
                                            <select 
                                                name="location"
                                                className="form-select"
                                                value={formData.location || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-property'}
                                            >
                                                <option value="">Select location</option>
                                                {Object.keys(MALTA_ZONES).map(zone => (
                                                    <option key={zone} value={zone}>{zone}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Price (‚Ç¨) *</label>
                                            <input 
                                                type="number" 
                                                name="price"
                                                className="form-input"
                                                value={formData.price || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-property'}
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Bedrooms *</label>
                                            <input 
                                                type="number" 
                                                name="bedrooms"
                                                className="form-input"
                                                value={formData.bedrooms || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-property'}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Description</label>
                                        <textarea 
                                            name="description"
                                            className="form-textarea"
                                            value={formData.description || ''}
                                            onChange={handleChange}
                                            disabled={type === 'view-property'}
                                        />
                                    </div>
                                    
                                    {type === 'add-property' && (
                                        <div className="modal-footer">
                                            <button type="button" className="btn btn-secondary" onClick={onClose}>
                                                Cancel
                                            </button>
                                            <button type="submit" className="btn btn-primary">
                                                Add Property
                                            </button>
                                        </div>
                                    )}
                                </form>
                            )}
                            
                            {(type === 'add-client' || type === 'view-client') && (
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Name *</label>
                                        <input 
                                            type="text" 
                                            name="name"
                                            className="form-input"
                                            value={formData.name || ''}
                                            onChange={handleChange}
                                            required
                                            disabled={type === 'view-client'}
                                        />
                                    </div>
                                    
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Email *</label>
                                            <input 
                                                type="email" 
                                                name="email"
                                                className="form-input"
                                                value={formData.email || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-client'}
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Phone *</label>
                                            <input 
                                                type="tel" 
                                                name="phone"
                                                className="form-input"
                                                value={formData.phone || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-client'}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Looking for *</label>
                                            <select 
                                                name="looking_for"
                                                className="form-select"
                                                value={formData.looking_for || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-client'}
                                            >
                                                <option value="">Select type</option>
                                                <option value="Apartment">Apartment</option>
                                                <option value="House">House</option>
                                                <option value="Villa">Villa</option>
                                                <option value="Commercial">Commercial</option>
                                            </select>
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Preferred Location *</label>
                                            <select 
                                                name="preferred_location"
                                                className="form-select"
                                                value={formData.preferred_location || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-client'}
                                            >
                                                <option value="">Select location</option>
                                                {Object.keys(MALTA_ZONES).map(zone => (
                                                    <option key={zone} value={zone}>{zone}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Budget (‚Ç¨) *</label>
                                            <input 
                                                type="number" 
                                                name="budget"
                                                className="form-input"
                                                value={formData.budget || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-client'}
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Min. Bedrooms *</label>
                                            <input 
                                                type="number" 
                                                name="min_bedrooms"
                                                className="form-input"
                                                value={formData.min_bedrooms || ''}
                                                onChange={handleChange}
                                                required
                                                disabled={type === 'view-client'}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Notes</label>
                                        <textarea 
                                            name="notes"
                                            className="form-textarea"
                                            value={formData.notes || ''}
                                            onChange={handleChange}
                                            disabled={type === 'view-client'}
                                        />
                                    </div>
                                    
                                    {type === 'add-client' && (
                                        <div className="modal-footer">
                                            <button type="button" className="btn btn-secondary" onClick={onClose}>
                                                Cancel
                                            </button>
                                            <button type="submit" className="btn btn-primary">
                                                Add Client
                                            </button>
                                        </div>
                                    )}
                                </form>
                            )}
                            
                            {type === 'add-reminder' && (
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Title *</label>
                                        <input 
                                            type="text" 
                                            name="title"
                                            className="form-input"
                                            value={formData.title || ''}
                                            onChange={handleChange}
                                            required
                                        />
                                    </div>
                                    
                                    <div className="grid grid-2">
                                        <div className="form-group">
                                            <label className="form-label">Due Date *</label>
                                            <input 
                                                type="date" 
                                                name="due_date"
                                                className="form-input"
                                                value={formData.due_date || ''}
                                                onChange={handleChange}
                                                required
                                            />
                                        </div>
                                        
                                        <div className="form-group">
                                            <label className="form-label">Priority *</label>
                                            <select 
                                                name="priority"
                                                className="form-select"
                                                value={formData.priority || ''}
                                                onChange={handleChange}
                                                required
                                            >
                                                <option value="">Select priority</option>
                                                <option value="low">Low</option>
                                                <option value="medium">Medium</option>
                                                <option value="high">High</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Description</label>
                                        <textarea 
                                            name="description"
                                            className="form-textarea"
                                            value={formData.description || ''}
                                            onChange={handleChange}
                                        />
                                    </div>
                                    
                                    <div className="modal-footer">
                                        <button type="button" className="btn btn-secondary" onClick={onClose}>
                                            Cancel
                                        </button>
                                        <button type="submit" className="btn btn-primary">
                                            Add Reminder
                                        </button>
                                    </div>
                                </form>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        
        // Render App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('‚úÖ Service Worker registered'))
                    .catch(err => console.log('‚ùå Service Worker error:', err));
            });
        }
    </script>
</body>
</html>

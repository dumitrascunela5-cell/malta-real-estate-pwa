<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malta Real Estate PRO - Supabase Edition</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Professional real estate management for Malta properties">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RE Malta">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; }
        
        /* Tailwind-like utilities */
        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
        .bg-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bg-white { background: white; }
        .rounded-lg { border-radius: 0.5rem; }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .p-6 { padding: 1.5rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-4 { gap: 1rem; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .text-white { color: white; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-800 { color: #1f2937; }
        .font-bold { font-weight: 700; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5a67d8; transform: translateY(-2px); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            border-radius: 0.5rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
        }
        .input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .property-card {
            background: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
        }
        .property-card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @media (min-width: 768px) {
            .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .container { padding: 2rem; }
        }
        
        .loading {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .setup-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .setup-card {
            background: white;
            border-radius: 1rem;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .setup-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .setup-subtitle {
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .help-text {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #4b5563;
        }
        
        .help-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .help-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // SUPABASE SETUP COMPONENT
        const SupabaseSetup = ({ onConfigSaved }) => {
            const [url, setUrl] = useState('');
            const [key, setKey] = useState('');
            const [error, setError] = useState('');
            const [testing, setTesting] = useState(false);

            const testConnection = async () => {
                if (!url || !key) {
                    setError('Please fill in both fields');
                    return;
                }

                setTesting(true);
                setError('');

                try {
                    const { createClient } = supabase;
                    const client = createClient(url.trim(), key.trim());
                    
                    // Test connection
                    const { error: testError } = await client.from('properties').select('count').limit(1);
                    
                    if (testError) {
                        setError(`Connection error: ${testError.message}`);
                        setTesting(false);
                        return;
                    }

                    // Save to localStorage
                    localStorage.setItem('supabase_url', url.trim());
                    localStorage.setItem('supabase_key', key.trim());
                    
                    onConfigSaved(client);
                } catch (err) {
                    setError(`Setup error: ${err.message}`);
                    setTesting(false);
                }
            };

            return (
                <div className="bg-gradient">
                    <div className="setup-container">
                        <div className="setup-card">
                            <div style={{ textAlign: 'center', marginBottom: '2rem' }}>
                                <div style={{ fontSize: '4rem', marginBottom: '1rem' }}>üè†</div>
                                <h1 className="setup-title">Malta Real Estate PRO</h1>
                                <p className="setup-subtitle">Configure your Supabase connection</p>
                            </div>

                            <div style={{ marginBottom: '1.5rem' }}>
                                <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem', color: '#374151' }}>
                                    Supabase URL
                                </label>
                                <input
                                    type="text"
                                    className="input"
                                    placeholder="https://your-project.supabase.co"
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                />
                            </div>

                            <div style={{ marginBottom: '1.5rem' }}>
                                <label style={{ display: 'block', fontWeight: 600, marginBottom: '0.5rem', color: '#374151' }}>
                                    Supabase Anon Key
                                </label>
                                <input
                                    type="password"
                                    className="input"
                                    placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                                    value={key}
                                    onChange={(e) => setKey(e.target.value)}
                                />
                            </div>

                            {error && (
                                <div style={{ background: '#fee2e2', color: '#991b1b', padding: '1rem', borderRadius: '0.5rem', marginBottom: '1rem' }}>
                                    {error}
                                </div>
                            )}

                            <button
                                onClick={testConnection}
                                disabled={testing}
                                className="btn btn-primary"
                                style={{ width: '100%', padding: '1rem', fontSize: '1.125rem' }}
                            >
                                {testing ? 'Testing Connection...' : 'Connect to Supabase'}
                            </button>

                            <div className="help-text">
                                <strong>Need help setting up Supabase?</strong><br/>
                                1. Go to <a href="https://supabase.com" target="_blank" className="help-link">supabase.com</a> and create a free account<br/>
                                2. Create a new project<br/>
                                3. Go to Settings ‚Üí API to find your URL and anon key<br/>
                                4. Run this SQL in the SQL Editor to create tables:<br/>
                                <pre style={{ background: '#1f2937', color: '#f3f4f6', padding: '1rem', borderRadius: '0.5rem', marginTop: '0.5rem', overflow: 'auto', fontSize: '0.75rem' }}>
{`-- Create properties table
CREATE TABLE properties (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  ref TEXT UNIQUE NOT NULL,
  location TEXT NOT NULL,
  price NUMERIC NOT NULL,
  bedrooms INTEGER NOT NULL,
  let_type TEXT NOT NULL,
  pets_allowed BOOLEAN DEFAULT false,
  available_from DATE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create clients table
CREATE TABLE clients (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  name TEXT NOT NULL,
  phone TEXT NOT NULL,
  nationality TEXT,
  max_budget NUMERIC NOT NULL,
  preferred_locations TEXT[] DEFAULT '{}',
  pets TEXT DEFAULT 'no',
  let_type TEXT NOT NULL,
  move_in_date DATE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Create updates table
CREATE TABLE updates (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  property_id UUID REFERENCES properties(id) ON DELETE CASCADE,
  client_id UUID REFERENCES clients(id) ON DELETE CASCADE,
  type TEXT NOT NULL,
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE properties ENABLE ROW LEVEL SECURITY;
ALTER TABLE clients ENABLE ROW LEVEL SECURITY;
ALTER TABLE updates ENABLE ROW LEVEL SECURITY;

-- Create policies (allow all operations for now)
CREATE POLICY "Enable all for properties" ON properties FOR ALL USING (true);
CREATE POLICY "Enable all for clients" ON clients FOR ALL USING (true);
CREATE POLICY "Enable all for updates" ON updates FOR ALL USING (true);`}
                                </pre>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // MAIN APP COMPONENT
        const App = () => {
            const [supabaseClient, setSupabaseClient] = useState(null);
            const [properties, setProperties] = useState([]);
            const [clients, setClients] = useState([]);
            const [updates, setUpdates] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showAddProperty, setShowAddProperty] = useState(false);
            const [showAddClient, setShowAddClient] = useState(false);
            const [notification, setNotification] = useState(null);

            // Initialize Supabase
            useEffect(() => {
                const url = localStorage.getItem('supabase_url');
                const key = localStorage.getItem('supabase_key');

                if (url && key) {
                    const { createClient } = supabase;
                    const client = createClient(url, key);
                    setSupabaseClient(client);
                } else {
                    setLoading(false);
                }
            }, []);

            // Load data from Supabase
            useEffect(() => {
                if (supabaseClient) {
                    loadData();
                }
            }, [supabaseClient]);

            const loadData = async () => {
                try {
                    const [propsRes, clientsRes, updatesRes] = await Promise.all([
                        supabaseClient.from('properties').select('*').order('created_at', { ascending: false }),
                        supabaseClient.from('clients').select('*').order('created_at', { ascending: false }),
                        supabaseClient.from('updates').select('*').order('created_at', { ascending: false }).limit(50)
                    ]);

                    if (propsRes.data) setProperties(propsRes.data);
                    if (clientsRes.data) setClients(clientsRes.data);
                    if (updatesRes.data) setUpdates(updatesRes.data);
                } catch (error) {
                    showNotification('Error loading data: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            // Add Property
            const addProperty = async (property) => {
                try {
                    const { data, error } = await supabaseClient
                        .from('properties')
                        .insert([property])
                        .select()
                        .single();

                    if (error) throw error;

                    setProperties([data, ...properties]);
                    setShowAddProperty(false);
                    showNotification('Property added successfully!');
                } catch (error) {
                    showNotification('Error adding property: ' + error.message, 'error');
                }
            };

            // Delete Property
            const deleteProperty = async (id) => {
                if (!confirm('Are you sure you want to delete this property?')) return;

                try {
                    const { error } = await supabaseClient
                        .from('properties')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    setProperties(properties.filter(p => p.id !== id));
                    showNotification('Property deleted');
                } catch (error) {
                    showNotification('Error deleting property: ' + error.message, 'error');
                }
            };

            // Add Client
            const addClient = async (client) => {
                try {
                    const { data, error } = await supabaseClient
                        .from('clients')
                        .insert([client])
                        .select()
                        .single();

                    if (error) throw error;

                    setClients([data, ...clients]);
                    setShowAddClient(false);
                    showNotification('Client added successfully!');
                } catch (error) {
                    showNotification('Error adding client: ' + error.message, 'error');
                }
            };

            // Delete Client
            const deleteClient = async (id) => {
                if (!confirm('Are you sure you want to delete this client?')) return;

                try {
                    const { error } = await supabaseClient
                        .from('clients')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    setClients(clients.filter(c => c.id !== id));
                    showNotification('Client deleted');
                } catch (error) {
                    showNotification('Error deleting client: ' + error.message, 'error');
                }
            };

            // Property Form
            const PropertyForm = () => {
                const [formData, setFormData] = useState({
                    ref: '',
                    location: '',
                    price: '',
                    bedrooms: '1',
                    let_type: 'long',
                    pets_allowed: false,
                    available_from: ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    addProperty({
                        ...formData,
                        price: parseFloat(formData.price),
                        bedrooms: parseInt(formData.bedrooms)
                    });
                };

                return (
                    <div className="modal" onClick={() => setShowAddProperty(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                            <h2 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>Add New Property</h2>
                            <form onSubmit={handleSubmit}>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Reference</label>
                                    <input
                                        type="text"
                                        className="input"
                                        value={formData.ref}
                                        onChange={(e) => setFormData({ ...formData, ref: e.target.value })}
                                        required
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Location</label>
                                    <input
                                        type="text"
                                        className="input"
                                        value={formData.location}
                                        onChange={(e) => setFormData({ ...formData, location: e.target.value })}
                                        required
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Monthly Price (‚Ç¨)</label>
                                    <input
                                        type="number"
                                        className="input"
                                        value={formData.price}
                                        onChange={(e) => setFormData({ ...formData, price: e.target.value })}
                                        required
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Bedrooms</label>
                                    <select
                                        className="input"
                                        value={formData.bedrooms}
                                        onChange={(e) => setFormData({ ...formData, bedrooms: e.target.value })}
                                    >
                                        {[1, 2, 3, 4, 5].map(n => <option key={n} value={n}>{n}</option>)}
                                    </select>
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Let Type</label>
                                    <select
                                        className="input"
                                        value={formData.let_type}
                                        onChange={(e) => setFormData({ ...formData, let_type: e.target.value })}
                                    >
                                        <option value="long">Long-term</option>
                                        <option value="short">Short-term</option>
                                    </select>
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                        <input
                                            type="checkbox"
                                            checked={formData.pets_allowed}
                                            onChange={(e) => setFormData({ ...formData, pets_allowed: e.target.checked })}
                                        />
                                        Pets Allowed
                                    </label>
                                </div>
                                <div style={{ marginBottom: '1.5rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Available From</label>
                                    <input
                                        type="date"
                                        className="input"
                                        value={formData.available_from}
                                        onChange={(e) => setFormData({ ...formData, available_from: e.target.value })}
                                    />
                                </div>
                                <div style={{ display: 'flex', gap: '1rem' }}>
                                    <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>Add Property</button>
                                    <button type="button" className="btn" style={{ flex: 1, background: '#e5e7eb' }} onClick={() => setShowAddProperty(false)}>Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Client Form
            const ClientForm = () => {
                const [formData, setFormData] = useState({
                    name: '',
                    phone: '',
                    nationality: '',
                    max_budget: '',
                    preferred_locations: [],
                    pets: 'no',
                    let_type: 'long',
                    move_in_date: ''
                });

                const handleSubmit = (e) => {
                    e.preventDefault();
                    addClient({
                        ...formData,
                        max_budget: parseFloat(formData.max_budget)
                    });
                };

                return (
                    <div className="modal" onClick={() => setShowAddClient(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                            <h2 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>Add New Client</h2>
                            <form onSubmit={handleSubmit}>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Name</label>
                                    <input
                                        type="text"
                                        className="input"
                                        value={formData.name}
                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                        required
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Phone</label>
                                    <input
                                        type="tel"
                                        className="input"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                                        required
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Nationality</label>
                                    <input
                                        type="text"
                                        className="input"
                                        value={formData.nationality}
                                        onChange={(e) => setFormData({ ...formData, nationality: e.target.value })}
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Max Budget (‚Ç¨/month)</label>
                                    <input
                                        type="number"
                                        className="input"
                                        value={formData.max_budget}
                                        onChange={(e) => setFormData({ ...formData, max_budget: e.target.value })}
                                        required
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Preferred Locations (comma separated)</label>
                                    <input
                                        type="text"
                                        className="input"
                                        placeholder="Sliema, St. Julian's, Valletta"
                                        onChange={(e) => setFormData({ ...formData, preferred_locations: e.target.value.split(',').map(s => s.trim()) })}
                                    />
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Pets</label>
                                    <select
                                        className="input"
                                        value={formData.pets}
                                        onChange={(e) => setFormData({ ...formData, pets: e.target.value })}
                                    >
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                                <div style={{ marginBottom: '1rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Let Type</label>
                                    <select
                                        className="input"
                                        value={formData.let_type}
                                        onChange={(e) => setFormData({ ...formData, let_type: e.target.value })}
                                    >
                                        <option value="long">Long-term</option>
                                        <option value="short">Short-term</option>
                                    </select>
                                </div>
                                <div style={{ marginBottom: '1.5rem' }}>
                                    <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600 }}>Move-in Date</label>
                                    <input
                                        type="date"
                                        className="input"
                                        value={formData.move_in_date}
                                        onChange={(e) => setFormData({ ...formData, move_in_date: e.target.value })}
                                    />
                                </div>
                                <div style={{ display: 'flex', gap: '1rem' }}>
                                    <button type="submit" className="btn btn-primary" style={{ flex: 1 }}>Add Client</button>
                                    <button type="button" className="btn" style={{ flex: 1, background: '#e5e7eb' }} onClick={() => setShowAddClient(false)}>Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            // Dashboard View
            const Dashboard = () => (
                <div>
                    <h2 style={{ fontSize: '1.5rem', fontWeight: 700, marginBottom: '1.5rem' }}>Dashboard</h2>
                    <div className="grid grid-cols-1 gap-4" style={{ gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))' }}>
                        <div style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', padding: '2rem', borderRadius: '0.5rem', color: 'white' }}>
                            <div style={{ fontSize: '2.5rem', fontWeight: 700 }}>{properties.length}</div>
                            <div style={{ opacity: 0.9 }}>Total Properties</div>
                        </div>
                        <div style={{ background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', padding: '2rem', borderRadius: '0.5rem', color: 'white' }}>
                            <div style={{ fontSize: '2.5rem', fontWeight: 700 }}>{clients.length}</div>
                            <div style={{ opacity: 0.9 }}>Total Clients</div>
                        </div>
                        <div style={{ background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', padding: '2rem', borderRadius: '0.5rem', color: 'white' }}>
                            <div style={{ fontSize: '2.5rem', fontWeight: 700 }}>{properties.filter(p => p.pets_allowed).length}</div>
                            <div style={{ opacity: 0.9 }}>Pet-Friendly</div>
                        </div>
                    </div>
                </div>
            );

            // Properties List
            const PropertiesList = () => (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                        <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Properties ({properties.length})</h2>
                        <button onClick={() => setShowAddProperty(true)} className="btn btn-success">+ Add Property</button>
                    </div>
                    <div className="grid grid-cols-1 gap-4">
                        {properties.map(prop => (
                            <div key={prop.id} className="property-card">
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>
                                    <div>
                                        <h3 style={{ fontSize: '1.25rem', fontWeight: 700 }}>{prop.ref}</h3>
                                        <p style={{ color: '#6b7280' }}>üìç {prop.location}</p>
                                    </div>
                                    <button onClick={() => deleteProperty(prop.id)} className="btn btn-danger" style={{ padding: '0.5rem' }}>Delete</button>
                                </div>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.5rem', fontSize: '0.875rem' }}>
                                    <div>üí∞ ‚Ç¨{prop.price}/month</div>
                                    <div>üõèÔ∏è {prop.bedrooms} bedroom{prop.bedrooms > 1 ? 's' : ''}</div>
                                    <div>üìÖ {prop.let_type === 'long' ? 'Long-term' : 'Short-term'}</div>
                                    <div>üêæ {prop.pets_allowed ? 'Pets allowed' : 'No pets'}</div>
                                </div>
                                {prop.available_from && (
                                    <div style={{ marginTop: '0.5rem', fontSize: '0.875rem', color: '#059669' }}>
                                        Available from: {new Date(prop.available_from).toLocaleDateString()}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );

            // Clients List
            const ClientsList = () => (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1.5rem' }}>
                        <h2 style={{ fontSize: '1.5rem', fontWeight: 700 }}>Clients ({clients.length})</h2>
                        <button onClick={() => setShowAddClient(true)} className="btn btn-success">+ Add Client</button>
                    </div>
                    <div className="grid grid-cols-1 gap-4">
                        {clients.map(client => (
                            <div key={client.id} className="property-card">
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>
                                    <div>
                                        <h3 style={{ fontSize: '1.25rem', fontWeight: 700 }}>{client.name}</h3>
                                        <p style={{ color: '#6b7280' }}>üìû {client.phone}</p>
                                    </div>
                                    <button onClick={() => deleteClient(client.id)} className="btn btn-danger" style={{ padding: '0.5rem' }}>Delete</button>
                                </div>
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '0.5rem', fontSize: '0.875rem' }}>
                                    {client.nationality && <div>üåç {client.nationality}</div>}
                                    <div>üí∞ Budget: ‚Ç¨{client.max_budget}/month</div>
                                    <div>üìÖ {client.let_type === 'long' ? 'Long-term' : 'Short-term'}</div>
                                    <div>üêæ {client.pets === 'yes' ? 'Has pets' : 'No pets'}</div>
                                </div>
                                {client.preferred_locations && client.preferred_locations.length > 0 && (
                                    <div style={{ marginTop: '0.5rem', fontSize: '0.875rem' }}>
                                        üìç Preferred: {client.preferred_locations.join(', ')}
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );

            if (!supabaseClient) {
                return <SupabaseSetup onConfigSaved={setSupabaseClient} />;
            }

            if (loading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                    </div>
                );
            }

            return (
                <div className="bg-gradient" style={{ minHeight: '100vh' }}>
                    <div className="container">
                        <div className="bg-white rounded-lg shadow-xl p-6 mb-6">
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <div>
                                    <h1 className="text-3xl font-bold" style={{ color: '#1f2937', marginBottom: '0.5rem' }}>
                                        üè† Malta Real Estate PRO
                                    </h1>
                                    <p style={{ color: '#6b7280' }}>Cloud-Synced ‚Ä¢ Multi-Device Access</p>
                                </div>
                                <button
                                    onClick={() => {
                                        localStorage.removeItem('supabase_url');
                                        localStorage.removeItem('supabase_key');
                                        window.location.reload();
                                    }}
                                    className="btn"
                                    style={{ background: '#e5e7eb', color: '#374151' }}
                                >
                                    ‚öôÔ∏è Settings
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-xl mb-6">
                            <div style={{ display: 'flex', overflowX: 'auto' }}>
                                {['dashboard', 'properties', 'clients'].map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className="btn"
                                        style={{
                                            background: activeTab === tab ? '#667eea' : 'transparent',
                                            color: activeTab === tab ? 'white' : '#4b5563',
                                            borderRadius: 0,
                                            textTransform: 'capitalize',
                                            padding: '1rem 2rem'
                                        }}
                                    >
                                        {tab}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-xl p-6">
                            {activeTab === 'dashboard' && <Dashboard />}
                            {activeTab === 'properties' && <PropertiesList />}
                            {activeTab === 'clients' && <ClientsList />}
                        </div>
                    </div>

                    {showAddProperty && <PropertyForm />}
                    {showAddClient && <ClientForm />}

                    {notification && (
                        <div className="notification" style={{ background: notification.type === 'error' ? '#fee2e2' : '#d1fae5', color: notification.type === 'error' ? '#991b1b' : '#065f46' }}>
                            {notification.message}
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates periodically
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Check every minute
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed:', error);
                    });
            });
        }

        // Install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button/banner
            const installBanner = document.createElement('div');
            installBanner.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: white;
                padding: 1rem 2rem;
                border-radius: 50px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 10000;
                display: flex;
                gap: 1rem;
                align-items: center;
                animation: slideUp 0.3s ease-out;
            `;
            
            installBanner.innerHTML = `
                <span style="font-weight: 600;">üì≤ Install app for offline access</span>
                <button id="installBtn" style="
                    background: #667eea;
                    color: white;
                    border: none;
                    padding: 0.5rem 1.5rem;
                    border-radius: 25px;
                    font-weight: 600;
                    cursor: pointer;
                ">Install</button>
                <button id="dismissBtn" style="
                    background: transparent;
                    border: none;
                    color: #6b7280;
                    cursor: pointer;
                    font-size: 1.5rem;
                    padding: 0;
                    width: 30px;
                    height: 30px;
                ">√ó</button>
            `;
            
            document.body.appendChild(installBanner);
            
            document.getElementById('installBtn').addEventListener('click', async () => {
                installBanner.remove();
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to install prompt: ${outcome}`);
                deferredPrompt = null;
            });
            
            document.getElementById('dismissBtn').addEventListener('click', () => {
                installBanner.remove();
            });
        });

        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA installed successfully!');
            deferredPrompt = null;
        });

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideUp {
                from { transform: translate(-50%, 100px); opacity: 0; }
                to { transform: translate(-50%, 0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
